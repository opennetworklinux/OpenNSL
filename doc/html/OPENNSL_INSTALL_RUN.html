<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: Installing and Executing OpenNSL</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li class="current"><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Installing and Executing OpenNSL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The following pages explain how to <a class="el" href="OPENNSL_INSTALL_RUN.html#OPENNSL_INSTALL_RUN_GTO">Install and Execute OpenNSL on GTO</a> and how to <a class="el" href="OPENNSL_INSTALL_RUN.html#OPENNSL_INSTALL_RUN_IM">Install and Execute OpenNSL on IM Switch/Wedge Switch/Celestica Redstone XP Switch</a></p>
<h2><a class="anchor" id="OPENNSL_INSTALL_RUN_GTO"></a>
Install and Execute OpenNSL on GTO</h2>
<p>The following sections describes how to install and run OpenNSL examples provided in this package on the supported Broadcom Software Validation Kits (SVK). </p>
<h3><a class="anchor" id="CFESETUP"></a>
CFE Setup:</h3>
<p>The Linux kernel provided with this package requires CFE bootloader to be upgraded. These are the instructions to upgrade the CFE on the switch:</p>
<p>Boot the switch and stop at CFE&gt; prompt. If the switch does not present a CFE&gt; prompt on bootup, reset the switch and interrupt the boot sequence by entering ^C before CFE starts the application.</p>
<p>Upgrade the CFE:</p>
<ul>
<li>Copy the cfe.flash.bcm98548xmc file to a tftp server that the switch can access.</li>
<li>Enter the following at the CFE&gt; prompt: <pre>
       CFE&gt; ifconfig eth0 -auto
       CFE&gt; flash &lt;tftp_server_ip&gt;:&lt;file_path&gt;/cfe.flash.bcm98548xmc flash0.boot
</pre></li>
<li>Reset the switch: <pre>
       CFE&gt; reset -sysreset
</pre></li>
</ul>
<p>Setup CFE partitions: Enter the following at the CFE&gt; prompt: </p>
<pre>
     CFE&gt; ptable add cfe0 0x07f00000 0x00100000
     CFE&gt; ptable add linux 0x08000000 0x07b00000
     CFE&gt; ptable add lboot 0x0fb00000 0x400000
     CFE&gt; ptable save
     CFE&gt; reset -sysreset
</pre><p>Setup environment variables </p>
<pre>
   CFE&gt; setenv -p LINUX_CMDLINE "root=/dev/ram rw console=ttyS0,9600 rd_start=0x8000000 rd_size=1000000"
</pre><h3><a class="anchor" id="LINUXSETUP"></a>
Linux Kernel Setup:</h3>
<p>To load the Linux uImage via tftp, enter following commands at CFE&gt; prompt:</p>
<pre>
  CFE&gt; ifconfig eth0 -auto
  CFE&gt; boot -uboot &lt;tftp_server_ip&gt;:&lt;file_path&gt;/gto_uImage
</pre><p>Alternatively, you can write the Linux kernel/rootfs to the persistent flash: </p>
<pre>
  CFE&gt; ifconfig -auto eth0
  CFE&gt; flash -noheader &lt;tftp_server_ip&gt;:&lt;file_path&gt;/gto_uImage flash5.lboot
  CFE&gt; setenv -p STARTUP 'boot -uboot flash5.lboot:'
  CFE&gt; reset -sysreset
</pre><p>Once Linux starts, a login prompt will be displayed. Following username and password should be used to login: </p>
<pre>
User: root
Password: broadcom
</pre><h3><a class="anchor" id="DOWNLOADING_RUNNING_OPENNSL"></a>
Downloading and Executing OpenNSL Examples</h3>
<p>cd to target directory. To write to persistent flash storage, write to </p>
<pre>
  # cd /mnt/opennsl
</pre><p>Download the SDK kernel modules onto the switch. These files are available at opennsl_root/bin/&lt;platform&gt; directory. </p>
<pre>
  # tftp -g -r &lt;file_path&gt;/linux-kernel-bde.ko &lt;tftp_server_ip&gt;
  # tftp -g -r &lt;file_path&gt;/linux-user-bde.ko &lt;tftp_server_ip&gt;
  # tftp -g -r &lt;file_path&gt;/linux-bcm-knet.ko &lt;tftp_server_ip&gt;
</pre><p>Download the Shared objects and OpenNSL examples on the switch: </p>
<pre>
  # tftp -g -r &lt;file_path&gt;/*.so &lt;tftp_server_ip&gt;
  # cp *.so /lib/
  # tftp -g -r &lt;file_path&gt;/example_* &lt;tftp_server_ip&gt;
  # chmod 755 example_*
</pre><p>cd to target directory and start OpenNSL executable. </p>
<pre>
  #./example_*
</pre><h2><a class="anchor" id="OPENNSL_INSTALL_RUN_IM"></a>
Install and Execute OpenNSL on IM Switch/Wedge Switch/Celestica Redstone XP Switch</h2>
<h3><a class="anchor" id="DOWNLOAD_SETUP_ENV"></a>
Downloading Sample Applications and Basic Setup</h3>
<p>The OpenNSL target deliverables are available in opennsl_root/bin/&lt;platform&gt; directory.</p>
<p>Use the following commands to install SDK linux kernel modules </p>
<ul>
<li>Execute "lsmod" to list the installed linux kernel modules. </li>
<li>Remove the linux kernel and user modules by using "rmmod" command. </li>
<li>Install linux kernel modules: <pre>
   # mknod /dev/linux-kernel-bde c 127 0
   # mknod /dev/linux-user-bde c 126 0
   # mknod /dev/linux-bcm-knet c 122 0
   # insmod linux-kernel-bde.ko
   # insmod linux-user-bde.ko
   # insmod linux-bcm-knet.ko
</pre></li>
</ul>
<p>Install OpenNSL shared library. The destination directory to install the shared library depends on the host environment configuration. Install the library files in a location included in the system's library search path. </p>
<pre>
   # mv libopennsl.so.1 /usr/lib
   # cd /usr/lib
   # ln -sf libopennsl.so.1 libopennsl.so
</pre><h3><a class="anchor" id="RUN_OPENNSL_EXAMPLE"></a>
Executing OpenNSL Examples</h3>
<p>cd to target deliverables directory and run example applications </p>
<pre>
    # chmod +x example_l2_firewall
    #./example_l2_firewall
</pre><p>Issue "example_xxx \-\-help" for help on the example applications. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2015 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
