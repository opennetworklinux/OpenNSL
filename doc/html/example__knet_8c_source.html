<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/example_knet.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/example_knet.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="example__knet_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2015</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * \file         example_knet.c</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief        OpenNSL example application to demonstrate KNET module</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \details      This application allows the user to</span>
<a name="l00024"></a>00024 <span class="comment"> *               1) Create KNET interfaces that map to switch physical</span>
<a name="l00025"></a>00025 <span class="comment"> *               interfaces. These can be configurable from Linux command</span>
<a name="l00026"></a>00026 <span class="comment"> *               line interface.</span>
<a name="l00027"></a>00027 <span class="comment"> *               2) Delete KNET interface.</span>
<a name="l00028"></a>00028 <span class="comment"> *               3) List KNET interfaces.</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> **********************************************************************/</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="knet_8h.html">opennsl/knet.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00039"></a>00039 
<a name="l00040"></a><a class="code" href="example__knet_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00040</a> <span class="preprocessor">#define DEFAULT_UNIT 0</span>
<a name="l00041"></a><a class="code" href="example__knet_8c.html#a16b710f592bf8f7900666392adc444dc">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_PORT 1</span>
<a name="l00042"></a><a class="code" href="example__knet_8c.html#a91668ed1245d073a2ac84e6121205d28">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN 1</span>
<a name="l00043"></a><a class="code" href="example__knet_8c.html#a068278b0838b6670ab0ab0a93ed77484">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_DIGITS_IN_CHOICE 5</span>
<a name="l00044"></a><a class="code" href="example__knet_8c.html#a085ef30bb274af36520ea5f7b3df7cb8">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define KNET_INTF_COUNT 20</span>
<a name="l00045"></a><a class="code" href="example__knet_8c.html#aec550a179f6cebe6d10b9cf600144012">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define IP_ADDR_LEN 16</span>
<a name="l00046"></a><a class="code" href="example__knet_8c.html#a96d17404c99c88370ded218fd0992c6f">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define NETMASK_LEN 16</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="example__knet_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00048</a> <span class="keywordtype">char</span> <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00049"></a>00049 <span class="stringliteral">&quot;Syntax: example_knet                                                  \n\r&quot;</span>
<a name="l00050"></a>00050 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00051"></a>00051 <span class="stringliteral">&quot;Paramaters: None.                                                     \n\r&quot;</span>
<a name="l00052"></a>00052 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00053"></a>00053 <span class="stringliteral">&quot;Example: The following command is used to create KNET interfaces      \n\r&quot;</span>
<a name="l00054"></a>00054 <span class="stringliteral">&quot;         that can be configurable from Linux shell.                   \n\r&quot;</span>
<a name="l00055"></a>00055 <span class="stringliteral">&quot;         example_knet                                                 \n\r&quot;</span>
<a name="l00056"></a>00056 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00057"></a>00057 <span class="stringliteral">&quot;Usage Guidelines: This program request the user to enter the following\n\r&quot;</span>
<a name="l00058"></a>00058 <span class="stringliteral">&quot;                  parameters interactively                            \n\r&quot;</span>
<a name="l00059"></a>00059 <span class="stringliteral">&quot;       port    - port number                                          \n\r&quot;</span>
<a name="l00060"></a>00060 <span class="stringliteral">&quot;       ifName  - interface name                                       \n\r&quot;</span>
<a name="l00061"></a>00061 <span class="stringliteral">&quot;       ipaddr  - IP adddress to be assigned to the interface          \n\r&quot;</span>
<a name="l00062"></a>00062 <span class="stringliteral">&quot;       netmask - IP netmask to be assigned to the interface           \n\r&quot;</span>
<a name="l00063"></a>00063 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00064"></a>00064 <span class="stringliteral">&quot;       Testing:                                                       \n\r&quot;</span>
<a name="l00065"></a>00065 <span class="stringliteral">&quot;       1) Assign IP address to the interface using Create KNET        \n\r&quot;</span>
<a name="l00066"></a>00066 <span class="stringliteral">&quot;          interface option.                                           \n\r&quot;</span>
<a name="l00067"></a>00067 <span class="stringliteral">&quot;       2) Assign IP address to the partner that is connected to       \n\r&quot;</span>
<a name="l00068"></a>00068 <span class="stringliteral">&quot;          physical port in the same subnet.                           \n\r&quot;</span>
<a name="l00069"></a>00069 <span class="stringliteral">&quot;       3) Verify that ping to the IP assigned in step 1 works fine.   \n\r&quot;</span>
<a name="l00070"></a>00070 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>;
<a name="l00071"></a>00071 
<a name="l00072"></a>00072 <span class="comment">/* KNET data structure to store the netif.id and filter.id for</span>
<a name="l00073"></a>00073 <span class="comment"> * KNET interfaces */</span>
<a name="l00074"></a><a class="code" href="structknet__if__data__t.html">00074</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00075"></a>00075 {
<a name="l00076"></a><a class="code" href="structknet__if__data__t.html#ab11dce3bbd40af42656e07412df20a4b">00076</a>   <span class="keywordtype">int</span> <a class="code" href="structknet__if__data__t.html#ab11dce3bbd40af42656e07412df20a4b">port</a>;
<a name="l00077"></a><a class="code" href="structknet__if__data__t.html#a029c737e10214a636ea84fcfcb8772fa">00077</a>   <span class="keywordtype">int</span> <a class="code" href="structknet__if__data__t.html#a029c737e10214a636ea84fcfcb8772fa">netIfID</a>;
<a name="l00078"></a><a class="code" href="structknet__if__data__t.html#a5199b38e781a19580a25fbfd4683e09e">00078</a>   <span class="keywordtype">int</span> <a class="code" href="structknet__if__data__t.html#a5199b38e781a19580a25fbfd4683e09e">filterID</a>;
<a name="l00079"></a><a class="code" href="structknet__if__data__t.html#afea713fff29636d3e12c03c3a249dcf0">00079</a>   <span class="keywordtype">char</span> name[<a class="code" href="group__knet.html#ga50c30f6fcdb14cd2608fff6cc32cfde9">OPENNSL_KNET_NETIF_NAME_MAX</a>];
<a name="l00080"></a>00080 } <a class="code" href="structknet__if__data__t.html">knet_if_data_t</a>;
<a name="l00081"></a>00081 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00082"></a>00082 
<a name="l00083"></a><a class="code" href="example__knet_8c.html#aac07e37715eb6a5d8c5561564c213073">00083</a> <a class="code" href="structknet__if__data__t.html">knet_if_data_t</a> <a class="code" href="example__knet_8c.html#aac07e37715eb6a5d8c5561564c213073">knet_if_data</a>[<a class="code" href="example__knet_8c.html#a085ef30bb274af36520ea5f7b3df7cb8">KNET_INTF_COUNT</a>];
<a name="l00084"></a><a class="code" href="example__knet_8c.html#affd1902d4ba68e9125f7d55b11e0085b">00084</a> <span class="keywordtype">int</span> <a class="code" href="example__knet_8c.html#affd1902d4ba68e9125f7d55b11e0085b">knet_intf_count</a> = 0;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <span class="comment">/**************************************************************************/</span>
<a name="l00096"></a><a class="code" href="example__knet_8c.html#a4015686b88e268740c566ef899ceb1d5">00096</a> <span class="keywordtype">void</span> <a class="code" href="example__knet_8c.html#a4015686b88e268740c566ef899ceb1d5" title="Update KNET interface database.">example_knet_database_update</a>(<span class="keywordtype">int</span> port, <span class="keywordtype">char</span> *ifName, <span class="keywordtype">int</span> nID, <span class="keywordtype">int</span> fID)
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098   <span class="keywordtype">int</span> i;
<a name="l00099"></a>00099   <span class="keywordtype">int</span> entryFound = 0;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101   <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="example__knet_8c.html#a085ef30bb274af36520ea5f7b3df7cb8">KNET_INTF_COUNT</a>; i++)
<a name="l00102"></a>00102   {
<a name="l00103"></a>00103     <span class="comment">/* Check if the entry for the given port is already present */</span>
<a name="l00104"></a>00104     <span class="keywordflow">if</span>(port == knet_if_data[i].port)
<a name="l00105"></a>00105     {
<a name="l00106"></a>00106       entryFound = 1;
<a name="l00107"></a>00107       <span class="keywordflow">break</span>;
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109   }
<a name="l00110"></a>00110 
<a name="l00111"></a>00111   <span class="keywordflow">if</span>(entryFound == 0)
<a name="l00112"></a>00112   {
<a name="l00113"></a>00113     <span class="comment">/* Find the first free entry */</span>
<a name="l00114"></a>00114     <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="example__knet_8c.html#a085ef30bb274af36520ea5f7b3df7cb8">KNET_INTF_COUNT</a>; i++)
<a name="l00115"></a>00115     {
<a name="l00116"></a>00116       <span class="keywordflow">if</span>(knet_if_data[i].port == 0)
<a name="l00117"></a>00117       {
<a name="l00118"></a>00118         <span class="keywordflow">break</span>;
<a name="l00119"></a>00119       }
<a name="l00120"></a>00120     }
<a name="l00121"></a>00121   }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123   knet_if_data[i].<a class="code" href="structknet__if__data__t.html#ab11dce3bbd40af42656e07412df20a4b">port</a>     = port;
<a name="l00124"></a>00124   knet_if_data[i].<a class="code" href="structknet__if__data__t.html#a029c737e10214a636ea84fcfcb8772fa">netIfID</a>  = nID;
<a name="l00125"></a>00125   knet_if_data[i].<a class="code" href="structknet__if__data__t.html#a5199b38e781a19580a25fbfd4683e09e">filterID</a> = fID;
<a name="l00126"></a>00126   strcpy(knet_if_data[i].name, ifName);
<a name="l00127"></a>00127 
<a name="l00128"></a>00128   <span class="comment">/* Updated the new entry. So, increment KNET interface count */</span>
<a name="l00129"></a>00129   <span class="keywordflow">if</span>(entryFound == 0)
<a name="l00130"></a>00130   {
<a name="l00131"></a>00131     <a class="code" href="example__knet_8c.html#affd1902d4ba68e9125f7d55b11e0085b">knet_intf_count</a>++;
<a name="l00132"></a>00132   }
<a name="l00133"></a>00133   <span class="keywordflow">return</span>;
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 <span class="comment">/**************************************************************************/</span>
<a name="l00142"></a><a class="code" href="example__knet_8c.html#a19ae12ca0da24d1a6d2ca2dece6ca5cd">00142</a> <span class="keywordtype">void</span> <a class="code" href="example__knet_8c.html#a19ae12ca0da24d1a6d2ca2dece6ca5cd" title="Update KNET interface database.">example_knet_database_show</a>()
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144   <span class="keywordtype">int</span> i;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146   <span class="keywordflow">if</span>(<a class="code" href="example__knet_8c.html#affd1902d4ba68e9125f7d55b11e0085b">knet_intf_count</a> == 0)
<a name="l00147"></a>00147   {
<a name="l00148"></a>00148     printf(<span class="stringliteral">&quot;KNET interface table is empty.\n\r&quot;</span>);
<a name="l00149"></a>00149     <span class="keywordflow">return</span>;
<a name="l00150"></a>00150   }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152   printf(<span class="stringliteral">&quot;Number of KNET interfaces present: %d\n\n\r&quot;</span>, <a class="code" href="example__knet_8c.html#affd1902d4ba68e9125f7d55b11e0085b">knet_intf_count</a>);
<a name="l00153"></a>00153   <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="example__knet_8c.html#a085ef30bb274af36520ea5f7b3df7cb8">KNET_INTF_COUNT</a>; i++)
<a name="l00154"></a>00154   {
<a name="l00155"></a>00155     <span class="keywordflow">if</span>(knet_if_data[i].port != 0)
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157       printf(<span class="stringliteral">&quot;Port: %d Interface Name: %s netifID: %d filterID: %d\n\r&quot;</span>,
<a name="l00158"></a>00158           knet_if_data[i].port, knet_if_data[i].name,
<a name="l00159"></a>00159           knet_if_data[i].netIfID, knet_if_data[i].filterID);
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161   }
<a name="l00162"></a>00162   <span class="keywordflow">return</span>;
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="comment">/******************************************************************************</span>
<a name="l00167"></a>00167 <span class="comment"> * \brief     Creates linux interfaces and corresponding KNET filters to map</span>
<a name="l00168"></a>00168 <span class="comment"> *           each front panel interface to these linux interfaces.</span>
<a name="l00169"></a>00169 <span class="comment"> *</span>
<a name="l00170"></a>00170 <span class="comment"> * \param   port         [IN] port number</span>
<a name="l00171"></a>00171 <span class="comment"> * \param   unit         [IN] unit number</span>
<a name="l00172"></a>00172 <span class="comment"> * \param   ifName       [IN] interface name</span>
<a name="l00173"></a>00173 <span class="comment"> *</span>
<a name="l00174"></a>00174 <span class="comment"> * \return  None</span>
<a name="l00175"></a>00175 <span class="comment"> *</span>
<a name="l00176"></a>00176 <span class="comment"> *****************************************************************************/</span>
<a name="l00177"></a><a class="code" href="example__knet_8c.html#a64fa5b0034bf5b81aaaf6d4ddac925fe">00177</a> <span class="keywordtype">int</span> <a class="code" href="example__knet_8c.html#a64fa5b0034bf5b81aaaf6d4ddac925fe">example_linux_interface_create</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> port, <span class="keywordtype">char</span> *ifName)
<a name="l00178"></a>00178 {
<a name="l00179"></a>00179   <span class="keywordtype">int</span> rv;
<a name="l00180"></a>00180   <a class="code" href="structopennsl__knet__netif__s.html" title="Kernel network interface structure.">opennsl_knet_netif_t</a>  netif;
<a name="l00181"></a>00181   <a class="code" href="structopennsl__knet__filter__s.html" title="Kernel packet filter structure.">opennsl_knet_filter_t</a> filter;
<a name="l00182"></a>00182   <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> baseMac[6] = { 0x02, 0x10, 0x18, 0x00, 0x00, 0x01 };
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <a class="code" href="group__knet.html#ga1ad4fcfe73ea6b10548ef4e4a429516a" title="Initialize a opennsl_knet_netif_t structure.">opennsl_knet_netif_t_init</a>(&amp;netif);
<a name="l00185"></a>00185   netif.<a class="code" href="structopennsl__knet__netif__s.html#a00741bdb419e8b4c3f2e23eaefd1b45c" title="Network interface type (OPENNSL_KNET_NETIF_T_XXX).">type</a> = <a class="code" href="group__knet.html#ga1eb388188d5c3def1e9d1a30fa787a5c" title="Tx packets are sent to local device port bypassing switch logic.">OPENNSL_KNET_NETIF_T_TX_LOCAL_PORT</a>;
<a name="l00186"></a>00186   netif.<a class="code" href="structopennsl__knet__netif__s.html#aea18f7445cb057bac7ec4947fa4789eb" title="Local port associated with this interface.">port</a> = port; <span class="comment">/* Egress port */</span>
<a name="l00187"></a>00187   strcpy(netif.<a class="code" href="structopennsl__knet__netif__s.html#a2ca84335bf5d2e193b8efbb5791f4980" title="Network interface name (assigned by kernel)">name</a>, ifName); <span class="comment">/* Copy the base interface name */</span>
<a name="l00188"></a>00188   <span class="comment">/* Set MAC address associated with this interface */</span>
<a name="l00189"></a>00189   memcpy(netif.<a class="code" href="structopennsl__knet__netif__s.html#a64792d1dc273cd1c56cbfe6618e045a2" title="MAC address associated with this network interface.">mac_addr</a>, baseMac, 6);
<a name="l00190"></a>00190   rv = <a class="code" href="group__knet.html#ga39a8ddfc666355596d30f0644707d545" title="Create a kernel network interface.">opennsl_knet_netif_create</a>(unit, &amp;netif);
<a name="l00191"></a>00191   <span class="keywordflow">if</span> (rv &gt;= 0)
<a name="l00192"></a>00192   {
<a name="l00193"></a>00193     printf(<span class="stringliteral">&quot;Created Interface ID %d for interface name \&quot;%s\&quot; \n&quot;</span>,
<a name="l00194"></a>00194         netif.<a class="code" href="structopennsl__knet__netif__s.html#adf3127ebd1b6ad2fa3be2e2ebb8e8239" title="Network interface ID.">id</a>, ifName);
<a name="l00195"></a>00195   }
<a name="l00196"></a>00196   <span class="keywordflow">else</span>
<a name="l00197"></a>00197   {
<a name="l00198"></a>00198     printf(<span class="stringliteral">&quot;rv = %d Error creating KNET interface \&quot;%s\&quot; \n&quot;</span>, rv, ifName);
<a name="l00199"></a>00199     <span class="keywordflow">return</span> rv;
<a name="l00200"></a>00200   }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202   <span class="comment">/* Add filter for packets from port */</span>
<a name="l00203"></a>00203   <a class="code" href="group__knet.html#gad9d4b85a5832d3220053c5b7d5d2b336" title="Initialize a opennsl_knet_filter_t structure.">opennsl_knet_filter_t_init</a>(&amp;filter);
<a name="l00204"></a>00204 
<a name="l00205"></a>00205   filter.<a class="code" href="structopennsl__knet__filter__s.html#a164904e325fcba11b7dfb9aa36570075" title="Filter type (OPENNSL_KNET_FILTER_T_XXX).">type</a> = <a class="code" href="group__knet.html#ga3d60a347e7e88ff366800a86fdf26aab" title="Rx packet filter.">OPENNSL_KNET_FILTER_T_RX_PKT</a>;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207   <span class="comment">/*</span>
<a name="l00208"></a>00208 <span class="comment">     This filter is modified to **NOT** STRIP VLAN TAG when this port is</span>
<a name="l00209"></a>00209 <span class="comment">     attached to a bridge</span>
<a name="l00210"></a>00210 <span class="comment">   */</span>
<a name="l00211"></a>00211 
<a name="l00212"></a>00212   filter.<a class="code" href="structopennsl__knet__filter__s.html#a7c506ee65c66c97061244bc589646994" title="OPENNSL_KNET_FILTER_F_XXX flags.">flags</a> = <a class="code" href="group__knet.html#ga44d002d65e254c6ebec2f7c87d616ed4" title="Strip VLAN tag from packets sent to vitual network interfaces.">OPENNSL_KNET_FILTER_F_STRIP_TAG</a>;
<a name="l00213"></a>00213   filter.<a class="code" href="structopennsl__knet__filter__s.html#a9a13643c35222c912f05d80b405564d7" title="Filter priority (0 is highest).">priority</a> = 0;
<a name="l00214"></a>00214   <span class="comment">/* Send packet to network interface */</span>
<a name="l00215"></a>00215   filter.<a class="code" href="structopennsl__knet__filter__s.html#a6d736fd5c0933c8088a135d2442b6799" title="Filter destination type.">dest_type</a> = <a class="code" href="group__knet.html#ga07bf6691393cb4585b1399a34acc0d63" title="Send packet to virtual network interface.">OPENNSL_KNET_DEST_T_NETIF</a>;
<a name="l00216"></a>00216   filter.<a class="code" href="structopennsl__knet__filter__s.html#aeb50325d7de776f436e8404ad8e2a1e6" title="Filter destination ID.">dest_id</a> = netif.<a class="code" href="structopennsl__knet__netif__s.html#adf3127ebd1b6ad2fa3be2e2ebb8e8239" title="Network interface ID.">id</a>;
<a name="l00217"></a>00217   filter.<a class="code" href="structopennsl__knet__filter__s.html#a4bcefb8f36d9b925c343c99185add9db" title="OPENNSL_KNET_FILTER_M_XXX flags.">match_flags</a> = <a class="code" href="group__knet.html#gabb8c7e54206103413200b9c003c6136a" title="Match local ingress port.">OPENNSL_KNET_FILTER_M_INGPORT</a>;
<a name="l00218"></a>00218   filter.<a class="code" href="structopennsl__knet__filter__s.html#afd1057adab356754c2b8e5943a79b086" title="Local ingress port to match.">m_ingport</a> = port;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220   rv = <a class="code" href="group__knet.html#ga7fbe476c4145409756ca9d3526c2d81e" title="Create a kernel packet filter.">opennsl_knet_filter_create</a>(unit, &amp;filter);
<a name="l00221"></a>00221   <span class="keywordflow">if</span> (rv &gt;= 0)
<a name="l00222"></a>00222   {
<a name="l00223"></a>00223     printf(<span class="stringliteral">&quot;Created Filter ID %d for interface name \&quot;%s\&quot; \n&quot;</span>,
<a name="l00224"></a>00224         filter.<a class="code" href="structopennsl__knet__filter__s.html#ab22c479e0da164d7e6b5f276cd4b36f8" title="Filter ID.">id</a>, ifName);
<a name="l00225"></a>00225   }
<a name="l00226"></a>00226   <span class="keywordflow">else</span>
<a name="l00227"></a>00227   {
<a name="l00228"></a>00228     printf(<span class="stringliteral">&quot;rv  = %d Error creating filter for interface \&quot;%s\&quot; \n&quot;</span>,
<a name="l00229"></a>00229         rv, ifName);
<a name="l00230"></a>00230   }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232   <span class="comment">/* Update the database */</span>
<a name="l00233"></a>00233   <a class="code" href="example__knet_8c.html#a4015686b88e268740c566ef899ceb1d5" title="Update KNET interface database.">example_knet_database_update</a>(port, ifName, netif.<a class="code" href="structopennsl__knet__netif__s.html#adf3127ebd1b6ad2fa3be2e2ebb8e8239" title="Network interface ID.">id</a>, filter.<a class="code" href="structopennsl__knet__filter__s.html#ab22c479e0da164d7e6b5f276cd4b36f8" title="Filter ID.">id</a>);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235   <span class="keywordflow">return</span> rv;
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 <span class="comment">/******************************************************************************</span>
<a name="l00240"></a>00240 <span class="comment"> * \brief   Configure IP address and netmask on the KNET interface.</span>
<a name="l00241"></a>00241 <span class="comment"> *</span>
<a name="l00242"></a>00242 <span class="comment"> * \param   port         [IN] port number</span>
<a name="l00243"></a>00243 <span class="comment"> * \param   unit         [IN] unit number</span>
<a name="l00244"></a>00244 <span class="comment"> * \param   ifName       [IN] interface name</span>
<a name="l00245"></a>00245 <span class="comment"> *</span>
<a name="l00246"></a>00246 <span class="comment"> * \return  None</span>
<a name="l00247"></a>00247 <span class="comment"> *</span>
<a name="l00248"></a>00248 <span class="comment"> *****************************************************************************/</span>
<a name="l00249"></a><a class="code" href="example__knet_8c.html#a30842a1c9b7e57f9105a6c17ff86e335">00249</a> <span class="keywordtype">void</span> <a class="code" href="example__knet_8c.html#a30842a1c9b7e57f9105a6c17ff86e335">example_ip_config</a>(<span class="keywordtype">char</span> *ifName, <span class="keywordtype">char</span>* ip, <span class="keywordtype">char</span>* netmask)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251   <span class="keywordtype">char</span> cmd[100];
<a name="l00252"></a>00252 
<a name="l00253"></a>00253   memset(cmd, 0, <span class="keyword">sizeof</span>(cmd));
<a name="l00254"></a>00254   sprintf(cmd, <span class="stringliteral">&quot;ifconfig %s %s netmask %s up&quot;</span>, ifName, ip, netmask);
<a name="l00255"></a>00255   <span class="keywordflow">if</span>(system(cmd) == -1)
<a name="l00256"></a>00256   {
<a name="l00257"></a>00257     printf(<span class="stringliteral">&quot;Failed to configure interface \&quot;%s\&quot; with IP: %s Netmask: %s\n&quot;</span>,
<a name="l00258"></a>00258         ifName, ip, netmask);
<a name="l00259"></a>00259     <span class="keywordflow">return</span>;
<a name="l00260"></a>00260   };
<a name="l00261"></a>00261   printf(<span class="stringliteral">&quot;Configured interface \&quot;%s\&quot; with IP: %s Netmask: %s\n&quot;</span>,
<a name="l00262"></a>00262       ifName, ip, netmask);
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00265"></a>00265 
<a name="l00266"></a>00266 <span class="comment">/******************************************************************************</span>
<a name="l00267"></a>00267 <span class="comment"> * \brief   To create KNET interface by taking inputs from the user</span>
<a name="l00268"></a>00268 <span class="comment"> *</span>
<a name="l00269"></a>00269 <span class="comment"> * \param   unit         [IN] unit number</span>
<a name="l00270"></a>00270 <span class="comment"> *</span>
<a name="l00271"></a>00271 <span class="comment"> * \return  None</span>
<a name="l00272"></a>00272 <span class="comment"> *</span>
<a name="l00273"></a>00273 <span class="comment"> *****************************************************************************/</span>
<a name="l00274"></a><a class="code" href="example__knet_8c.html#a55c45cb01dca0a1b336efccb6130cb14">00274</a> <span class="keywordtype">void</span> <a class="code" href="example__knet_8c.html#a55c45cb01dca0a1b336efccb6130cb14">example_knet_intf_create</a>(<span class="keywordtype">int</span> unit)
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276   <span class="keywordtype">int</span> port;
<a name="l00277"></a>00277   <span class="keywordtype">int</span> rv;
<a name="l00278"></a>00278   <span class="keywordtype">char</span> ifName[<a class="code" href="group__knet.html#ga50c30f6fcdb14cd2608fff6cc32cfde9">OPENNSL_KNET_NETIF_NAME_MAX</a>];
<a name="l00279"></a>00279   <span class="keywordtype">char</span> ip[<a class="code" href="example__knet_8c.html#aec550a179f6cebe6d10b9cf600144012">IP_ADDR_LEN</a>];
<a name="l00280"></a>00280   <span class="keywordtype">char</span> netmask[<a class="code" href="example__knet_8c.html#a96d17404c99c88370ded218fd0992c6f">NETMASK_LEN</a>];
<a name="l00281"></a>00281 
<a name="l00282"></a>00282   <span class="keywordflow">if</span>(<a class="code" href="example__knet_8c.html#affd1902d4ba68e9125f7d55b11e0085b">knet_intf_count</a> == <a class="code" href="example__knet_8c.html#a085ef30bb274af36520ea5f7b3df7cb8">KNET_INTF_COUNT</a>)
<a name="l00283"></a>00283   {
<a name="l00284"></a>00284     printf(<span class="stringliteral">&quot;Maximum number of KNET interfaces are already present.\r\n&quot;</span>);
<a name="l00285"></a>00285     <span class="keywordflow">return</span>;
<a name="l00286"></a>00286   }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288   printf(<span class="stringliteral">&quot;\n\rEnter port number: \n&quot;</span>);
<a name="l00289"></a>00289   <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;port) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00290"></a>00290   {
<a name="l00291"></a>00291     printf(<span class="stringliteral">&quot;Invalid option entered.\n&quot;</span>);
<a name="l00292"></a>00292     <span class="keywordflow">return</span>;
<a name="l00293"></a>00293   }
<a name="l00294"></a>00294   printf(<span class="stringliteral">&quot;\n\rEnter knet interface name: &quot;</span>);
<a name="l00295"></a>00295   <span class="keywordflow">if</span>(gets(ifName) == <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00296"></a>00296   {
<a name="l00297"></a>00297     printf(<span class="stringliteral">&quot;\n\rInvalid KNET interface is entered.\n\r&quot;</span>);
<a name="l00298"></a>00298     <span class="keywordflow">return</span>;
<a name="l00299"></a>00299   }
<a name="l00300"></a>00300   printf(<span class="stringliteral">&quot;\n\rEnter IP address in dotted decimal format: &quot;</span>);
<a name="l00301"></a>00301   <span class="keywordflow">if</span>(gets(ip) == <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00302"></a>00302   {
<a name="l00303"></a>00303     printf(<span class="stringliteral">&quot;\n\rInvalid IP address is entered.\n\r&quot;</span>);
<a name="l00304"></a>00304     <span class="keywordflow">return</span>;
<a name="l00305"></a>00305   }
<a name="l00306"></a>00306   printf(<span class="stringliteral">&quot;\n\rEnter IP netmask in dotted decimal format: &quot;</span>);
<a name="l00307"></a>00307   <span class="keywordflow">if</span>(gets(netmask) == <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00308"></a>00308   {
<a name="l00309"></a>00309     printf(<span class="stringliteral">&quot;\n\rInvalid IP netmask is entered.\n\r&quot;</span>);
<a name="l00310"></a>00310     <span class="keywordflow">return</span>;
<a name="l00311"></a>00311   }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313   <span class="comment">/* Create Linux interface. */</span>
<a name="l00314"></a>00314   rv = <a class="code" href="example__knet_8c.html#a64fa5b0034bf5b81aaaf6d4ddac925fe">example_linux_interface_create</a>(unit, port, ifName);
<a name="l00315"></a>00315   <span class="keywordflow">if</span>(rv &gt;= 0) {
<a name="l00316"></a>00316     printf(<span class="stringliteral">&quot;Created Linux interface \&quot;%s\&quot; successfully.\r\n&quot;</span>, ifName);
<a name="l00317"></a>00317   }
<a name="l00318"></a>00318   <span class="keywordflow">else</span> {
<a name="l00319"></a>00319     printf(<span class="stringliteral">&quot;Failed to create Linux interface \&quot;%s\&quot;. rv: %d\r\n&quot;</span>, ifName, rv);
<a name="l00320"></a>00320   }
<a name="l00321"></a>00321 
<a name="l00322"></a>00322   <a class="code" href="example__knet_8c.html#a30842a1c9b7e57f9105a6c17ff86e335">example_ip_config</a>(ifName, ip, netmask);
<a name="l00323"></a>00323 }
<a name="l00324"></a>00324 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="comment">/******************************************************************************</span>
<a name="l00327"></a>00327 <span class="comment"> * \brief   To delete KNET interface.</span>
<a name="l00328"></a>00328 <span class="comment"> *</span>
<a name="l00329"></a>00329 <span class="comment"> * \param   unit         [IN] unit number</span>
<a name="l00330"></a>00330 <span class="comment"> *</span>
<a name="l00331"></a>00331 <span class="comment"> * \return  None</span>
<a name="l00332"></a>00332 <span class="comment"> *</span>
<a name="l00333"></a>00333 <span class="comment"> *****************************************************************************/</span>
<a name="l00334"></a><a class="code" href="example__knet_8c.html#a3c9f9a94f61c9adb5228fd241d913d99">00334</a> <span class="keywordtype">void</span> <a class="code" href="example__knet_8c.html#a3c9f9a94f61c9adb5228fd241d913d99">example_knet_intf_delete</a>(<span class="keywordtype">int</span> unit)
<a name="l00335"></a>00335 {
<a name="l00336"></a>00336   <span class="keywordtype">int</span> rv;
<a name="l00337"></a>00337   <span class="keywordtype">int</span> i;
<a name="l00338"></a>00338   <span class="keywordtype">char</span> ifName[<a class="code" href="group__knet.html#ga50c30f6fcdb14cd2608fff6cc32cfde9">OPENNSL_KNET_NETIF_NAME_MAX</a>];
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <span class="keywordflow">if</span>(<a class="code" href="example__knet_8c.html#affd1902d4ba68e9125f7d55b11e0085b">knet_intf_count</a> == 0)
<a name="l00341"></a>00341   {
<a name="l00342"></a>00342     printf(<span class="stringliteral">&quot;\n\rThere are no KNET interfaces present in the system.\n\r&quot;</span>);
<a name="l00343"></a>00343   }
<a name="l00344"></a>00344   printf(<span class="stringliteral">&quot;\n\rEnter KNET interface name: &quot;</span>);
<a name="l00345"></a>00345   <span class="keywordflow">if</span>(gets(ifName) == <a class="code" href="sal_2types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00346"></a>00346   {
<a name="l00347"></a>00347     printf(<span class="stringliteral">&quot;\n\rInvalid KNET interface is entered.\n\r&quot;</span>);
<a name="l00348"></a>00348     <span class="keywordflow">return</span>;
<a name="l00349"></a>00349   }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351   <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="example__knet_8c.html#a085ef30bb274af36520ea5f7b3df7cb8">KNET_INTF_COUNT</a>; i++)
<a name="l00352"></a>00352   {
<a name="l00353"></a>00353     <span class="keywordflow">if</span>(strcmp(ifName, knet_if_data[i].name) == 0)
<a name="l00354"></a>00354     {
<a name="l00355"></a>00355       <span class="keywordflow">break</span>;
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357   }
<a name="l00358"></a>00358 
<a name="l00359"></a>00359   <span class="keywordflow">if</span> (i == KNET_INTF_COUNT)
<a name="l00360"></a>00360   {
<a name="l00361"></a>00361     printf(<span class="stringliteral">&quot;\n\rThe specific interface is not found.\n\r&quot;</span>);
<a name="l00362"></a>00362     <span class="keywordflow">return</span>;
<a name="l00363"></a>00363   }
<a name="l00364"></a>00364 
<a name="l00365"></a>00365   <span class="comment">/* Destroy KNET interface. */</span>
<a name="l00366"></a>00366   rv = <a class="code" href="group__knet.html#gabbf345bae6d0b19dcf474df554dc7a0c" title="Destroy a kernel network interface.">opennsl_knet_netif_destroy</a>(unit, knet_if_data[i].netIfID);
<a name="l00367"></a>00367   <span class="keywordflow">if</span>(rv &lt; 0) {
<a name="l00368"></a>00368     printf(<span class="stringliteral">&quot;Error destroying network interface: %s\n&quot;</span>,
<a name="l00369"></a>00369         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00370"></a>00370     <span class="keywordflow">return</span>;
<a name="l00371"></a>00371   }
<a name="l00372"></a>00372 
<a name="l00373"></a>00373   rv = <a class="code" href="group__knet.html#ga11b88af6e9943e7145dd6ce3d6ccca2d" title="Destroy a kernel packet filter.">opennsl_knet_filter_destroy</a>(unit, knet_if_data[i].filterID);
<a name="l00374"></a>00374   <span class="keywordflow">if</span>(rv &lt; 0) {
<a name="l00375"></a>00375     printf(<span class="stringliteral">&quot;Error destroying packet filter: %s\n&quot;</span>,
<a name="l00376"></a>00376         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00377"></a>00377     <span class="keywordflow">return</span>;
<a name="l00378"></a>00378   }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380   <span class="comment">/* Clear the database for the deleted port */</span>
<a name="l00381"></a>00381   memset(&amp;knet_if_data[i], 0, <span class="keyword">sizeof</span>(<a class="code" href="structknet__if__data__t.html">knet_if_data_t</a>));
<a name="l00382"></a>00382   <a class="code" href="example__knet_8c.html#affd1902d4ba68e9125f7d55b11e0085b">knet_intf_count</a>--;
<a name="l00383"></a>00383 }
<a name="l00384"></a>00384 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 <span class="comment">/*****************************************************************/</span>
<a name="l00393"></a><a class="code" href="example__knet_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00393</a> <span class="keywordtype">int</span> <a class="code" href="example__bst_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for bst sample application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00394"></a>00394 {
<a name="l00395"></a>00395   <span class="keywordtype">int</span> rv = 0;
<a name="l00396"></a>00396   <span class="keywordtype">int</span> unit = <a class="code" href="example__knet_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00397"></a>00397   <span class="keywordtype">int</span> choice;
<a name="l00398"></a>00398 
<a name="l00399"></a>00399   <span class="keywordflow">if</span>((argc != 1) || ((argc &gt; 1) &amp;&amp; (strcmp(argv[1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {
<a name="l00400"></a>00400     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00401"></a>00401     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00402"></a>00402   }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404   <span class="comment">/* Initialize the system */</span>
<a name="l00405"></a>00405   rv = <a class="code" href="driver_8h.html#a1c3e46e06d91a45608e9839952c60ff2">opennsl_driver_init</a>();
<a name="l00406"></a>00406 
<a name="l00407"></a>00407   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00408"></a>00408     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system. Error %s\r\n&quot;</span>,
<a name="l00409"></a>00409         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00410"></a>00410     <span class="keywordflow">return</span> rv;
<a name="l00411"></a>00411   }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413   <span class="comment">/* Add ports to default vlan. */</span>
<a name="l00414"></a>00414   printf(<span class="stringliteral">&quot;Adding ports to default VLAN %d.\r\n&quot;</span>, <a class="code" href="example__knet_8c.html#a91668ed1245d073a2ac84e6121205d28">DEFAULT_VLAN</a>);
<a name="l00415"></a>00415   rv = <a class="code" href="examples_2util_8h.html#a2d14e4de1f4a7192ac7e378f8f7c63ff" title="Add all ports to default vlan.">example_switch_default_vlan_config</a>(unit);
<a name="l00416"></a>00416   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00417"></a>00417     printf(<span class="stringliteral">&quot;\r\nFailed to add ports to default VLAN %d. rv: %d\r\n&quot;</span>,
<a name="l00418"></a>00418         <a class="code" href="example__knet_8c.html#a91668ed1245d073a2ac84e6121205d28">DEFAULT_VLAN</a>,  rv);
<a name="l00419"></a>00419   }
<a name="l00420"></a>00420 
<a name="l00421"></a>00421   <span class="keywordflow">while</span>(1) {
<a name="l00422"></a>00422 
<a name="l00423"></a>00423     printf(<span class="stringliteral">&quot;\nUser Menu: Select one of the following options\n&quot;</span>);
<a name="l00424"></a>00424     printf(<span class="stringliteral">&quot;1. Create KNET interface\n&quot;</span>);
<a name="l00425"></a>00425     printf(<span class="stringliteral">&quot;2. Delete KNET interface\n&quot;</span>);
<a name="l00426"></a>00426     printf(<span class="stringliteral">&quot;3. Display KNET interface database\n&quot;</span>);
<a name="l00427"></a>00427 <span class="preprocessor">#ifndef CDP_EXCLUDE</span>
<a name="l00428"></a>00428 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00429"></a>00429 <span class="preprocessor">#endif</span>
<a name="l00430"></a>00430 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application.\n&quot;</span>);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00433"></a>00433     {
<a name="l00434"></a>00434       printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00435"></a>00435       <span class="keywordflow">continue</span>;
<a name="l00436"></a>00436     }
<a name="l00437"></a>00437     <span class="keywordflow">switch</span>(choice) {
<a name="l00438"></a>00438       <span class="keywordflow">case</span> 1:
<a name="l00439"></a>00439       {
<a name="l00440"></a>00440         <a class="code" href="example__knet_8c.html#a55c45cb01dca0a1b336efccb6130cb14">example_knet_intf_create</a>(unit);
<a name="l00441"></a>00441         <span class="keywordflow">break</span>;
<a name="l00442"></a>00442       }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444       <span class="keywordflow">case</span> 2:
<a name="l00445"></a>00445       {
<a name="l00446"></a>00446         <a class="code" href="example__knet_8c.html#a3c9f9a94f61c9adb5228fd241d913d99">example_knet_intf_delete</a>(unit);
<a name="l00447"></a>00447         <span class="keywordflow">break</span>;
<a name="l00448"></a>00448       }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450       <span class="keywordflow">case</span> 3:
<a name="l00451"></a>00451       {
<a name="l00452"></a>00452         <a class="code" href="example__knet_8c.html#a19ae12ca0da24d1a6d2ca2dece6ca5cd" title="Update KNET interface database.">example_knet_database_show</a>();
<a name="l00453"></a>00453         <span class="keywordflow">break</span>;
<a name="l00454"></a>00454       }
<a name="l00455"></a>00455 
<a name="l00456"></a>00456 <span class="preprocessor">#ifndef CDP_EXCLUDE</span>
<a name="l00457"></a>00457 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00458"></a>00458       {
<a name="l00459"></a>00459         <a class="code" href="driver_8h.html#a471900b16ad87718cd84e257ef98ca57">opennsl_driver_shell</a>();
<a name="l00460"></a>00460         <span class="keywordflow">break</span>;
<a name="l00461"></a>00461       }
<a name="l00462"></a>00462 <span class="preprocessor">#endif</span>
<a name="l00463"></a>00463 <span class="preprocessor"></span>
<a name="l00464"></a>00464       <span class="keywordflow">case</span> 0:
<a name="l00465"></a>00465       {
<a name="l00466"></a>00466         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00467"></a>00467         <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00468"></a>00468       }
<a name="l00469"></a>00469 
<a name="l00470"></a>00470       <span class="keywordflow">default</span>:
<a name="l00471"></a>00471         <span class="keywordflow">break</span>;;
<a name="l00472"></a>00472     } <span class="comment">/* End of switch */</span>
<a name="l00473"></a>00473   } <span class="comment">/* End of while */</span>
<a name="l00474"></a>00474 
<a name="l00475"></a>00475   <span class="keywordflow">return</span> rv;
<a name="l00476"></a>00476 }
<a name="l00477"></a>00477 <span class="comment">/* __doxy_func_body_end__ */</span>
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2015 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
