<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/example_routing.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/example_routing.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="example__routing_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2015</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> * \file         example_routing.c</span>
<a name="l00020"></a>00020 <span class="comment"> *</span>
<a name="l00021"></a>00021 <span class="comment"> * \brief        OPENNSL example program to demonstrate routing</span>
<a name="l00022"></a>00022 <span class="comment"> *</span>
<a name="l00023"></a>00023 <span class="comment"> * \details      This example demonstrates routing of packets across</span>
<a name="l00024"></a>00024 <span class="comment"> * two different VLAN&#39;s by using host route and default routes.</span>
<a name="l00025"></a>00025 <span class="comment"> * In the first case, switch installs a host route to route</span>
<a name="l00026"></a>00026 <span class="comment"> * packets from INGRESS_VLAN, destination MAC = MY_MAC to HOST1</span>
<a name="l00027"></a>00027 <span class="comment"> * attached to EGRESS_VLAN. But, in the second case a default</span>
<a name="l00028"></a>00028 <span class="comment"> * route is installed to route packets from INGRESS_VLAN,</span>
<a name="l00029"></a>00029 <span class="comment"> * destination MAC = MY_MAC destined to DEFAULT_SUBNET_IP to</span>
<a name="l00030"></a>00030 <span class="comment"> * egress port that is a member of EGRESS_VLAN.</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> * This application also supports Warmboot feature. Warmboot is</span>
<a name="l00033"></a>00033 <span class="comment"> * the process of restarting the device driver software while</span>
<a name="l00034"></a>00034 <span class="comment"> * the hardware is running without interrupting the dataplane.</span>
<a name="l00035"></a>00035 <span class="comment"> *</span>
<a name="l00036"></a>00036 <span class="comment"> * Setup the following envinonment variable before running the application.</span>
<a name="l00037"></a>00037 <span class="comment"> * For Cold boot mode, use &quot;export SOC_BOOT_FLAGS = 0x000000&quot;.</span>
<a name="l00038"></a>00038 <span class="comment"> * For Warm boot mode, use &quot;export SOC_BOOT_FLAGS = 0x200000&quot;.</span>
<a name="l00039"></a>00039 <span class="comment"> *</span>
<a name="l00040"></a>00040 <span class="comment"> **********************************************************************/</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2switch_8h.html">opennsl/switch.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="l3_8h.html">opennsl/l3.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="example__routing_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00052</a> <span class="keywordtype">char</span> <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00053"></a>00053 <span class="stringliteral">&quot;Syntax: example_routing                                                \n\r&quot;</span>
<a name="l00054"></a>00054 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00055"></a>00055 <span class="stringliteral">&quot;Paramaters:                                                            \n\r&quot;</span>
<a name="l00056"></a>00056 <span class="stringliteral">&quot;       in_sysport  - Ingress port number on which test packet is       \n\r&quot;</span>
<a name="l00057"></a>00057 <span class="stringliteral">&quot;                     received                                          \n\r&quot;</span>
<a name="l00058"></a>00058 <span class="stringliteral">&quot;       out_sysport - Egress port number to which packet is routed.     \n\r&quot;</span>
<a name="l00059"></a>00059 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00060"></a>00060 <span class="stringliteral">&quot;Example: The following command is used to demonstrate routing from     \n\r&quot;</span>
<a name="l00061"></a>00061 <span class="stringliteral">&quot;         port 2 to port 6.                                             \n\r&quot;</span>
<a name="l00062"></a>00062 <span class="stringliteral">&quot;         example_routing 2 6                                           \n\r&quot;</span>
<a name="l00063"></a>00063 <span class="stringliteral">&quot;                                                                       \n\r&quot;</span>
<a name="l00064"></a>00064 <span class="stringliteral">&quot;Usage Guidelines: This program request the user to enter the           \n\r&quot;</span>
<a name="l00065"></a>00065 <span class="stringliteral">&quot;       ingress and egress port numbers. Using the host route, it routes\n\r&quot;</span>
<a name="l00066"></a>00066 <span class="stringliteral">&quot;       the packets arrived on ingress port with VLAN = 10,             \n\r&quot;</span>
<a name="l00067"></a>00067 <span class="stringliteral">&quot;       destination MAC = 00:11:22:33:99:58 to host 20.1.1.2 attached   \n\r&quot;</span>
<a name="l00068"></a>00068 <span class="stringliteral">&quot;       to egress port that is a member of VLAN 20. Using the default   \n\r&quot;</span>
<a name="l00069"></a>00069 <span class="stringliteral">&quot;       route, it also routes packets with VLAN = 10, destination       \n\r&quot;</span>
<a name="l00070"></a>00070 <span class="stringliteral">&quot;       MAC = 00:11:22:33:99:58 destinated to subnet 55.0.0.0 to egress \n\r&quot;</span>
<a name="l00071"></a>00071 <span class="stringliteral">&quot;       port that is a member of VLAN 20.                               \n\r&quot;</span>
<a name="l00072"></a>00072 <span class="stringliteral">&quot;       The routed packet should have destination MAC same as           \n\r&quot;</span>
<a name="l00073"></a>00073 <span class="stringliteral">&quot;       00:00:70:5B:C7:34 with TTL decremented by 1.                    \n\r&quot;</span>;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a><a class="code" href="example__routing_8c.html#a30c3344f99ac40e769705eda221a6b5b">00076</a> <span class="preprocessor">#define INGRESS_VLAN    10</span>
<a name="l00077"></a><a class="code" href="example__routing_8c.html#a344c92147986035627b0d387b8790318">00077</a> <span class="preprocessor"></span><span class="preprocessor">#define EGRESS_VLAN     20</span>
<a name="l00078"></a><a class="code" href="example__routing_8c.html#a2971da41865730e076908e0ae6757103">00078</a> <span class="preprocessor"></span><span class="preprocessor">#define HOST1           0x14010102         </span><span class="comment">/* 20.1.1.2 */</span>
<a name="l00079"></a><a class="code" href="example__routing_8c.html#a84f447ab6677e412dc77e89f08152369">00079</a> <span class="preprocessor">#define DEFAULT_SUBNET_IP   0x37000000     </span><span class="comment">/* 55.0.0.0 */</span>
<a name="l00080"></a><a class="code" href="example__routing_8c.html#a6bf0d6365e5891e41a12fe0a84452a46">00080</a> <span class="preprocessor">#define DEFAULT_SUBNET_MASK 0xff000000     </span><span class="comment">/* /8 network */</span>
<a name="l00081"></a><a class="code" href="example__routing_8c.html#aeaa487f5205c0aac9da4e004c173429c">00081</a> <span class="preprocessor">#define MY_MAC          {0x00, 0x11, 0x22, 0x33, 0x99, 0x58}</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00083"></a><a class="code" href="example__routing_8c.html#ac777a672bdb738a1ffcbb511b6ba2ed9">00083</a> <span class="preprocessor">#define NEXTHOP_MAC     {0x00, 0x00, 0x70, 0x5B, 0xC7, 0x34}</span>
<a name="l00084"></a>00084 <span class="preprocessor"></span><span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00085"></a><a class="code" href="example__routing_8c.html#a068278b0838b6670ab0ab0a93ed77484">00085</a> <span class="preprocessor">#define MAX_DIGITS_IN_CHOICE 5</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>
<a name="l00087"></a>00087 <span class="comment">/* debug prints */</span>
<a name="l00088"></a><a class="code" href="example__routing_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">00088</a> <span class="keywordtype">int</span> <a class="code" href="example__routing_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> = 3;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="comment">/**************************************************************************/</span>
<a name="l00101"></a><a class="code" href="example__routing_8c.html#a77f5075286ba75ef3a0aba5c78caa121">00101</a> <span class="keywordtype">int</span> <a class="code" href="example__routing_8c.html#a77f5075286ba75ef3a0aba5c78caa121" title="To add a given MAC and VID to the L2 forwarding database.">example_l2_addr_add</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac, <span class="keywordtype">int</span> port, <span class="keywordtype">int</span> vid) {
<a name="l00102"></a>00102 
<a name="l00103"></a>00103   <span class="keywordtype">int</span> rv;
<a name="l00104"></a>00104   <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> l2addr;
<a name="l00105"></a>00105 
<a name="l00106"></a>00106   <a class="code" href="group__l2.html#ga47e819cf5939a8e643ad09505df52071" title="Initialize an L2 address structure to a specified MAC address and VLAN ID.">opennsl_l2_addr_t_init</a>(&amp;l2addr, mac, vid);
<a name="l00107"></a>00107   l2addr.<a class="code" href="structopennsl__l2__addr__s.html#a7546884120ba8ab5dce9348fd9bd819f" title="Zero-based port number.">port</a>  = port;
<a name="l00108"></a>00108   l2addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a> = (<a class="code" href="group__l2.html#ga63e21bad2bb28702ea2ba636f548e35c">OPENNSL_L2_L3LOOKUP</a> | <a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a>);
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   rv = <a class="code" href="group__l2.html#ga4b8920c1c3cf4c0c59bf8f0c5890f7c5" title="Add an L2 address entry to the specified device.">opennsl_l2_addr_add</a>(unit, &amp;l2addr);
<a name="l00111"></a>00111   <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00112"></a>00112     <span class="keywordflow">return</span> rv;
<a name="l00113"></a>00113   }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00116"></a>00116 }
<a name="l00117"></a>00117 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <span class="comment">/**************************************************************************/</span>
<a name="l00131"></a><a class="code" href="example__routing_8c.html#ac9cfacb45897ca750ecf0a789813eaff">00131</a> <span class="keywordtype">int</span> <a class="code" href="example__routing_8c.html#ac9cfacb45897ca750ecf0a789813eaff" title="To add a port to the VLAN.">example_vlan_port_add</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> open_vlan,
<a name="l00132"></a>00132     <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan, <span class="keywordtype">int</span> port)
<a name="l00133"></a>00133 {
<a name="l00134"></a>00134   <a class="code" href="struct__shr__pbmp.html">opennsl_pbmp_t</a>  pbmp, upbmp;
<a name="l00135"></a>00135   <span class="keywordtype">int</span> rc = <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00136"></a>00136 
<a name="l00137"></a>00137   <span class="keywordflow">if</span>(open_vlan) {
<a name="l00138"></a>00138     rc = <a class="code" href="group__vlan.html#ga4db9e633ba9c276064768d1718c3062c" title="Allocate and configure a VLAN on the OPENNSL device.">opennsl_vlan_create</a>(unit, vlan);
<a name="l00139"></a>00139     <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00140"></a>00140       printf(<span class="stringliteral">&quot;failed to create vlan(%d)&quot;</span>, vlan);
<a name="l00141"></a>00141       <span class="keywordflow">return</span> rc;
<a name="l00142"></a>00142     }
<a name="l00143"></a>00143     <span class="keywordflow">if</span>(<a class="code" href="example__routing_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 3) {
<a name="l00144"></a>00144       printf(<span class="stringliteral">&quot;Created VLAN: %d\n&quot;</span>, vlan);
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146   }
<a name="l00147"></a>00147 
<a name="l00148"></a>00148   <span class="comment">/* Add the test ports to the vlan */</span>
<a name="l00149"></a>00149   <a class="code" href="group__types.html#gafe134087fe1330ec8fffbe7685f139b8">OPENNSL_PBMP_CLEAR</a>(pbmp);
<a name="l00150"></a>00150   <a class="code" href="group__types.html#gafe134087fe1330ec8fffbe7685f139b8">OPENNSL_PBMP_CLEAR</a>(upbmp);
<a name="l00151"></a>00151   <a class="code" href="group__types.html#ga7a3934e09536bcaabfdf0f5aefc48411">OPENNSL_PBMP_PORT_ADD</a>(pbmp, port);
<a name="l00152"></a>00152   rc = <a class="code" href="group__vlan.html#ga1e7cecaf6718cd174f1b1aef29349340" title="Add ports to the specified VLAN.">opennsl_vlan_port_add</a>(unit, vlan, pbmp, upbmp);
<a name="l00153"></a>00153   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a> &amp;&amp; rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5ad03e135eecd46c9c1280e7b3f6ab5b6a">OPENNSL_E_EXISTS</a>) {
<a name="l00154"></a>00154     <span class="keywordflow">return</span> rc;
<a name="l00155"></a>00155   }
<a name="l00156"></a>00156   <span class="keywordflow">return</span> rc;
<a name="l00157"></a>00157 }
<a name="l00158"></a>00158 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00159"></a>00159 
<a name="l00160"></a>00160 <span class="comment">/**************************************************************************/</span>
<a name="l00178"></a><a class="code" href="example__routing_8c.html#a04eabb557cecbe6d7f8f9aa84a5fa74d">00178</a> <span class="keywordtype">int</span> <a class="code" href="example__routing_8c.html#a04eabb557cecbe6d7f8f9aa84a5fa74d" title="Creates Router interface.">example_create_l3_intf</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> open_vlan, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> port,
<a name="l00179"></a>00179     <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vid, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac_addr, <span class="keywordtype">int</span> *l3_id) {
<a name="l00180"></a>00180 
<a name="l00181"></a>00181   <span class="keywordtype">int</span> rc;
<a name="l00182"></a>00182   <a class="code" href="structopennsl__l3__intf__s.html" title="L3 Interface Structure.">opennsl_l3_intf_t</a> l3_intf;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment">/* Create VLAN and add port to the VLAN membership */</span>
<a name="l00185"></a>00185   rc = <a class="code" href="example__routing_8c.html#ac9cfacb45897ca750ecf0a789813eaff" title="To add a port to the VLAN.">example_vlan_port_add</a>(unit, open_vlan, vid, port);
<a name="l00186"></a>00186   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a> &amp;&amp; rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5ad03e135eecd46c9c1280e7b3f6ab5b6a">OPENNSL_E_EXISTS</a>) {
<a name="l00187"></a>00187     printf(<span class="stringliteral">&quot;Fail to add port %d to vlan %d. Return Code: %s\n&quot;</span>, port, vid, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rc));
<a name="l00188"></a>00188     <span class="keywordflow">return</span> rc;
<a name="l00189"></a>00189   }
<a name="l00190"></a>00190   <span class="keywordflow">if</span>(<a class="code" href="example__routing_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l00191"></a>00191     printf(<span class="stringliteral">&quot;Port %d is participating in VLAN: %d\n&quot;</span>, port, vid);
<a name="l00192"></a>00192   }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="comment">/* Create L3 interface */</span>
<a name="l00195"></a>00195   <a class="code" href="group__l3.html#gaa92edab97138caed29fe11f4f9b35fa7" title="Initialize a opennsl_l3_intf_t structure.">opennsl_l3_intf_t_init</a>(&amp;l3_intf);
<a name="l00196"></a>00196   memcpy(l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#ace9be269a08c66e4420c4a11b1689936" title="MAC address.">l3a_mac_addr</a>, mac_addr, 6);
<a name="l00197"></a>00197   l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#acc865cc8d7ef1ed69ca9d3648ad47c07" title="VLAN ID.">l3a_vid</a> = vid;
<a name="l00198"></a>00198   rc = <a class="code" href="group__l3.html#ga9706ea196e518e48a9a7940471c7a04d" title="Create a new L3 interface.">opennsl_l3_intf_create</a>(unit, &amp;l3_intf);
<a name="l00199"></a>00199   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00200"></a>00200     printf(<span class="stringliteral">&quot;l3_setup: opennsl_l3_intf_create failed: %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rc));
<a name="l00201"></a>00201     <span class="keywordflow">return</span> rc;
<a name="l00202"></a>00202   }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204   *l3_id = l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>;
<a name="l00205"></a>00205 
<a name="l00206"></a>00206   <span class="keywordflow">if</span>(<a class="code" href="example__routing_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 3) {
<a name="l00207"></a>00207     printf(<span class="stringliteral">&quot;L3 interface is created with parameters: \n  VLAN %d \n&quot;</span>, vid);
<a name="l00208"></a>00208     <a class="code" href="examples_2util_8h.html#a3262fde70495cd6e0f3afd6baf9ae95c" title="To print the MAC address.">l2_print_mac</a>(<span class="stringliteral">&quot;  MAC Address: &quot;</span>, mac_addr);
<a name="l00209"></a>00209     printf(<span class="stringliteral">&quot;\n\r&quot;</span>);
<a name="l00210"></a>00210     printf(<span class="stringliteral">&quot;  L3 Interface ID: %d\r\n&quot;</span>, l3_intf.<a class="code" href="structopennsl__l3__intf__s.html#aad83eb732b3da244ed88ee02531bea82" title="Interface ID.">l3a_intf_id</a>);
<a name="l00211"></a>00211   }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213   <span class="keywordflow">return</span> rc;
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 <span class="comment">/**************************************************************************/</span>
<a name="l00236"></a><a class="code" href="example__routing_8c.html#a95a6480e9efa3bdf9ec640a482c7f685">00236</a> <span class="keywordtype">int</span> <a class="code" href="example__routing_8c.html#a95a6480e9efa3bdf9ec640a482c7f685" title="create l3 egress object object includes next hop information.">example_create_l3_egress</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flags, <span class="keywordtype">int</span> out_port, <span class="keywordtype">int</span> vlan,
<a name="l00237"></a>00237     <span class="keywordtype">int</span> l3_eg_intf, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> next_hop_mac_addr,
<a name="l00238"></a>00238     <span class="keywordtype">int</span> *intf) {
<a name="l00239"></a>00239   <span class="keywordtype">int</span> rc;
<a name="l00240"></a>00240   <a class="code" href="structopennsl__l3__egress__s.html" title="L3 Egress Structure.">opennsl_l3_egress_t</a> l3eg;
<a name="l00241"></a>00241   <a class="code" href="group__types.html#gaca0e18617c36271957788ac01ba44c2e" title="opennsl_if_t">opennsl_if_t</a> l3egid;
<a name="l00242"></a>00242   <span class="keywordtype">int</span> mod = 0;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244   <a class="code" href="group__l3.html#ga10b5ea766149d2bfdcd9d453939057e5" title="Initialize a opennsl_l3_egress_t structure.">opennsl_l3_egress_t_init</a>(&amp;l3eg);
<a name="l00245"></a>00245   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a495387f57bb66a0b0c38842564af10ec" title="L3 interface (source MAC, tunnel).">intf</a> = l3_eg_intf;
<a name="l00246"></a>00246   memcpy(l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a414a0355e3fd86ac89a7f061810f4ce6" title="Next hop forwarding destination mac.">mac_addr</a>, next_hop_mac_addr, 6);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#a4559c3254ee6ba88106523dd8c9b4422" title="Next hop vlan id.">vlan</a>   = vlan;
<a name="l00249"></a>00249   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#ac2808e98d73621c12f027186fb74cbaf">module</a> = mod;
<a name="l00250"></a>00250   l3eg.<a class="code" href="structopennsl__l3__egress__s.html#af53aa7695462aa231d4ba889ad06601a" title="Port packet switched to (if !OPENNSL_L3_TGID).">port</a>   = out_port;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252   l3egid = *intf;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254   rc = <a class="code" href="group__l3.html#ga0b4c7fdba7b362a408ba712e6894ee50" title="Create an Egress forwarding object.">opennsl_l3_egress_create</a>(unit, flags, &amp;l3eg, &amp;l3egid);
<a name="l00255"></a>00255   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00256"></a>00256     printf(<span class="stringliteral">&quot;Error, create egress object, out_port=%d, \n&quot;</span>, out_port);
<a name="l00257"></a>00257     <span class="keywordflow">return</span> rc;
<a name="l00258"></a>00258   }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   *intf = l3egid;
<a name="l00261"></a>00261 
<a name="l00262"></a>00262   <span class="keywordflow">if</span>(<a class="code" href="example__routing_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 2) {
<a name="l00263"></a>00263     printf(<span class="stringliteral">&quot;Created L3 egress ID %d for out_port: %d vlan: %d &quot;</span>
<a name="l00264"></a>00264         <span class="stringliteral">&quot;L3 egress intf: %d\n&quot;</span>,
<a name="l00265"></a>00265         *intf, out_port, vlan, l3_eg_intf);
<a name="l00266"></a>00266   }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268   <span class="keywordflow">return</span> rc;
<a name="l00269"></a>00269 }
<a name="l00270"></a>00270 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="comment">/**************************************************************************/</span>
<a name="l00281"></a><a class="code" href="example__routing_8c.html#aac2edc87c4397b83513067ac545599ea">00281</a> <span class="keywordtype">int</span> <a class="code" href="example__routing_8c.html#aac2edc87c4397b83513067ac545599ea" title="Add host address to the routing table.">example_add_host</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> addr, <span class="keywordtype">int</span> intf) {
<a name="l00282"></a>00282   <span class="keywordtype">int</span> rc;
<a name="l00283"></a>00283   <a class="code" href="structopennsl__l3__host__s.html" title="L3 Host Structure.">opennsl_l3_host_t</a> l3host;
<a name="l00284"></a>00284   <a class="code" href="group__l3.html#ga2902ef9ba3facbb09cf79ad9f97e32a4" title="Initialize a opennsl_l3_host_t structure.">opennsl_l3_host_t_init</a>(&amp;l3host);
<a name="l00285"></a>00285 
<a name="l00286"></a>00286   l3host.<a class="code" href="structopennsl__l3__host__s.html#ab24ca9ef38b0dfa61e097e10cf97bc60" title="See OPENNSL_L3_xxx flag definitions.">l3a_flags</a> = 0;
<a name="l00287"></a>00287   l3host.<a class="code" href="structopennsl__l3__host__s.html#a3143b4bacdaa29423449a37f71d6343f" title="Destination host IP address (IPv4).">l3a_ip_addr</a> = addr;
<a name="l00288"></a>00288   l3host.<a class="code" href="structopennsl__l3__host__s.html#a00aa36c796ba45462b1eecd1dcaa7e58" title="L3 intf associated with this address.">l3a_intf</a> = intf;
<a name="l00289"></a>00289   l3host.<a class="code" href="structopennsl__l3__host__s.html#a7bb54abde72384e8b7dc7693791105c6" title="Port/TGID packet is switched to.">l3a_port_tgid</a> = 0;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   rc = <a class="code" href="group__l3.html#ga2ff0b5376d55cc362714e343d192db45" title="Add an entry into the L3 switching table.">opennsl_l3_host_add</a>(unit, &amp;l3host);
<a name="l00292"></a>00292   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00293"></a>00293     printf (<span class="stringliteral">&quot;opennsl_l3_host_add failed. Return Code: %s \n&quot;</span>,
<a name="l00294"></a>00294         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rc));
<a name="l00295"></a>00295   }
<a name="l00296"></a>00296 
<a name="l00297"></a>00297   <span class="keywordflow">if</span>(<a class="code" href="example__routing_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 1) {
<a name="l00298"></a>00298     <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot;add host &quot;</span>, addr);
<a name="l00299"></a>00299     printf(<span class="stringliteral">&quot; ---&gt; egress-object = %d\n&quot;</span>, intf);
<a name="l00300"></a>00300   }
<a name="l00301"></a>00301 
<a name="l00302"></a>00302   <span class="keywordflow">return</span> rc;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="comment">/**************************************************************************/</span>
<a name="l00319"></a><a class="code" href="example__routing_8c.html#abce61c2dc135d7be41729d8dc9f5cf31">00319</a> <span class="keywordtype">int</span> <a class="code" href="example__routing_8c.html#abce61c2dc135d7be41729d8dc9f5cf31" title="Add default route to a subnet.">example_set_default_route</a>(<span class="keywordtype">int</span> unit, <span class="keywordtype">int</span> subnet, <span class="keywordtype">int</span> mask,
<a name="l00320"></a>00320     <span class="keywordtype">int</span> intf, <a class="code" href="group__types.html#ga238c767c6c5b6a0a47dd9d1504936cf0" title="GPORT (generic port) definitions.">opennsl_gport_t</a> trap_port) {
<a name="l00321"></a>00321   <span class="keywordtype">int</span> rc;
<a name="l00322"></a>00322   <a class="code" href="structopennsl__l3__route__s.html" title="L3 Route Structure.">opennsl_l3_route_t</a> l3rt;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324   <a class="code" href="group__l3.html#ga97c194ad2c065d5bf45d3f3a9c6c0998" title="Initialize a opennsl_l3_route_t structure.">opennsl_l3_route_t_init</a>(&amp;l3rt);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326   l3rt.<a class="code" href="structopennsl__l3__route__s.html#acfbb25072754c882757a9738475a3fd6" title="See OPENNSL_L3_xxx flag definitions.">l3a_flags</a> = 0;
<a name="l00327"></a>00327 
<a name="l00328"></a>00328   <span class="comment">/* to indicate it&#39;s default route, set subnet to zero */</span>
<a name="l00329"></a>00329   l3rt.<a class="code" href="structopennsl__l3__route__s.html#a433b102f16a1b6aa9366a03f83b44e77" title="IP subnet address (IPv4).">l3a_subnet</a> = subnet;
<a name="l00330"></a>00330   l3rt.<a class="code" href="structopennsl__l3__route__s.html#af36c5f11f9ed1ea6f18a96e180ec48fa" title="IP subnet mask (IPv4).">l3a_ip_mask</a> = mask;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332   l3rt.<a class="code" href="structopennsl__l3__route__s.html#a6154bd36147b624e453f82a5396be222" title="L3 interface associated with route.">l3a_intf</a> = intf;
<a name="l00333"></a>00333   l3rt.<a class="code" href="structopennsl__l3__route__s.html#a2eddc194bf238ce2510a4fdf26e4c6f6" title="Port or trunk group ID.">l3a_port_tgid</a> = trap_port;
<a name="l00334"></a>00334 
<a name="l00335"></a>00335   rc = <a class="code" href="group__l3.html#gafc35f6809a98707e3c54610512094a1d" title="Add an IP route to the L3 route table.">opennsl_l3_route_add</a>(unit, &amp;l3rt);
<a name="l00336"></a>00336   <span class="keywordflow">if</span> (rc != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00337"></a>00337     printf (<span class="stringliteral">&quot;opennsl_l3_route_add failed. Return Code: %s \n&quot;</span>,
<a name="l00338"></a>00338         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rc));
<a name="l00339"></a>00339   }
<a name="l00340"></a>00340 
<a name="l00341"></a>00341   <span class="keywordflow">if</span>(<a class="code" href="example__routing_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 1) {
<a name="l00342"></a>00342     <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot;add default route for subnet &quot;</span>, subnet);
<a name="l00343"></a>00343     <a class="code" href="examples_2util_8h.html#a8af6968664b72ffda55645d67cb908be" title="To print IP address in dotted decimal format.">print_ip_addr</a>(<span class="stringliteral">&quot; with mask &quot;</span>, mask);
<a name="l00344"></a>00344     printf(<span class="stringliteral">&quot; ---&gt; egress-object = %d\n&quot;</span>, intf);
<a name="l00345"></a>00345   }
<a name="l00346"></a>00346   <span class="keywordflow">return</span> rc;
<a name="l00347"></a>00347 }
<a name="l00348"></a>00348 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00349"></a>00349 
<a name="l00350"></a>00350 <span class="comment">/*****************************************************************/</span>
<a name="l00357"></a><a class="code" href="example__routing_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00357</a> <span class="keywordtype">int</span> <a class="code" href="example__bst_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for bst sample application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00358"></a>00358 {
<a name="l00359"></a>00359   <span class="keywordtype">int</span> rv = 0;
<a name="l00360"></a>00360   <span class="keywordtype">int</span> unit = 0;
<a name="l00361"></a>00361   <span class="keywordtype">int</span> choice;
<a name="l00362"></a>00362   <span class="keywordtype">int</span> ing_intf_in = 0;
<a name="l00363"></a>00363   <span class="keywordtype">int</span> ing_intf_out = 0;
<a name="l00364"></a>00364   <span class="keywordtype">int</span> l3egid;
<a name="l00365"></a>00365   <span class="keywordtype">int</span> flags = 0;
<a name="l00366"></a>00366   <span class="keywordtype">int</span> open_vlan = 1;
<a name="l00367"></a>00367   <span class="keywordtype">int</span> in_sysport;
<a name="l00368"></a>00368   <span class="keywordtype">int</span> out_sysport;
<a name="l00369"></a>00369   <span class="keywordtype">int</span> in_vlan  = <a class="code" href="example__routing_8c.html#a30c3344f99ac40e769705eda221a6b5b">INGRESS_VLAN</a>;
<a name="l00370"></a>00370   <span class="keywordtype">int</span> out_vlan = <a class="code" href="example__routing_8c.html#a344c92147986035627b0d387b8790318">EGRESS_VLAN</a>;
<a name="l00371"></a>00371   <span class="keywordtype">int</span> host, subnet, mask;
<a name="l00372"></a>00372   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> my_mac  = <a class="code" href="example__routing_8c.html#aeaa487f5205c0aac9da4e004c173429c">MY_MAC</a>;  <span class="comment">/* my-MAC */</span>
<a name="l00373"></a>00373   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> next_hop_mac  = <a class="code" href="example__routing_8c.html#ac777a672bdb738a1ffcbb511b6ba2ed9">NEXTHOP_MAC</a>; <span class="comment">/* next_hop_mac1 */</span>
<a name="l00374"></a>00374   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> warm_boot;
<a name="l00375"></a>00375   <span class="keywordtype">int</span> index = 0;
<a name="l00376"></a>00376 
<a name="l00377"></a>00377   <span class="keywordflow">if</span>(strcmp(argv[0], <span class="stringliteral">&quot;gdb&quot;</span>) == 0)
<a name="l00378"></a>00378   {
<a name="l00379"></a>00379     index = 1;
<a name="l00380"></a>00380   }
<a name="l00381"></a>00381   <span class="keywordflow">if</span>((argc != (index + 3)) || ((argc &gt; (index + 1)) 
<a name="l00382"></a>00382         &amp;&amp; (strcmp(argv[index + 1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {
<a name="l00383"></a>00383     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00384"></a>00384     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00385"></a>00385   }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387   warm_boot = <a class="code" href="examples_2util_8h.html#a40d56641f8e6b64b49c9813b7c27c75a" title="To get boot flags fetched from environment.">opennsl_boot_flags_get</a>() &amp; <a class="code" href="examples_2util_8h.html#aa6fc4fddb8d12deb70b0401eba5b8c54">OPENNSL_BOOT_F_WARM_BOOT</a>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389   <span class="comment">/* Initialize the system */</span>
<a name="l00390"></a>00390   rv = <a class="code" href="driver_8h.html#a1c3e46e06d91a45608e9839952c60ff2">opennsl_driver_init</a>();
<a name="l00391"></a>00391 
<a name="l00392"></a>00392   <span class="keywordflow">if</span>(rv != 0) {
<a name="l00393"></a>00393     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system.\r\n&quot;</span>);
<a name="l00394"></a>00394     <span class="keywordflow">return</span> rv;
<a name="l00395"></a>00395   }
<a name="l00396"></a>00396 
<a name="l00397"></a>00397   <span class="comment">/* Extract inputs parameters */</span>
<a name="l00398"></a>00398   in_sysport   = atoi(argv[index + 1]);
<a name="l00399"></a>00399   out_sysport  = atoi(argv[index + 2]);
<a name="l00400"></a>00400 
<a name="l00401"></a>00401   <span class="keywordflow">if</span>(!warm_boot)
<a name="l00402"></a>00402   {
<a name="l00403"></a>00403     <span class="comment">/* Set L3 Egress Mode */</span>
<a name="l00404"></a>00404     rv =  <a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca99cbe7dac9fc5a734a46fdcf66b2e291" title="Enable advanced egress management.">opennslSwitchL3EgressMode</a>, 1);
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00406"></a>00406       <span class="keywordflow">return</span> rv;
<a name="l00407"></a>00407     }
<a name="l00408"></a>00408     <span class="keywordflow">if</span>(<a class="code" href="example__routing_8c.html#a0b2caeb4b6f130be43e5a2f0267dd453">verbose</a> &gt;= 3) {
<a name="l00409"></a>00409       printf(<span class="stringliteral">&quot;\nL3 Egress mode is set succesfully\n&quot;</span>);
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="comment">/*** create ingress router interface ***/</span>
<a name="l00413"></a>00413     rv = <a class="code" href="example__routing_8c.html#a04eabb557cecbe6d7f8f9aa84a5fa74d" title="Creates Router interface.">example_create_l3_intf</a>(unit, open_vlan, in_sysport, in_vlan,
<a name="l00414"></a>00414         my_mac, &amp;ing_intf_in);
<a name="l00415"></a>00415     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00416"></a>00416       printf(<span class="stringliteral">&quot;Error, create ingress interface-1, in_sysport=%d, in unit %d \n&quot;</span>,
<a name="l00417"></a>00417           in_sysport, unit);
<a name="l00418"></a>00418     }
<a name="l00419"></a>00419 
<a name="l00420"></a>00420     <span class="comment">/*** create egress router interface ***/</span>
<a name="l00421"></a>00421     rv = <a class="code" href="example__routing_8c.html#a04eabb557cecbe6d7f8f9aa84a5fa74d" title="Creates Router interface.">example_create_l3_intf</a>(unit, open_vlan, out_sysport, out_vlan,
<a name="l00422"></a>00422         my_mac, &amp;ing_intf_out);
<a name="l00423"></a>00423     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00424"></a>00424       printf(<span class="stringliteral">&quot;Error, create egress interface-1, out_sysport=%d, in unit %d \n&quot;</span>,
<a name="l00425"></a>00425           out_sysport, unit);
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <span class="comment">/*** Make the address learn on a VLAN and port */</span>
<a name="l00429"></a>00429     rv = <a class="code" href="example__routing_8c.html#a77f5075286ba75ef3a0aba5c78caa121" title="To add a given MAC and VID to the L2 forwarding database.">example_l2_addr_add</a>(unit, my_mac, in_sysport, in_vlan);
<a name="l00430"></a>00430     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00431"></a>00431       printf(<span class="stringliteral">&quot;Failed to add L2 address. Return Code: %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00432"></a>00432       <span class="keywordflow">return</span> rv;
<a name="l00433"></a>00433     }
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     rv = <a class="code" href="example__routing_8c.html#a77f5075286ba75ef3a0aba5c78caa121" title="To add a given MAC and VID to the L2 forwarding database.">example_l2_addr_add</a>(unit, my_mac, out_sysport, out_vlan);
<a name="l00436"></a>00436     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00437"></a>00437       printf(<span class="stringliteral">&quot;Failed to add L2 address. Return Code: %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00438"></a>00438       <span class="keywordflow">return</span> rv;
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="comment">/*** create egress object 1 ***/</span>
<a name="l00442"></a>00442     flags = 0;
<a name="l00443"></a>00443     rv = <a class="code" href="example__routing_8c.html#a95a6480e9efa3bdf9ec640a482c7f685" title="create l3 egress object object includes next hop information.">example_create_l3_egress</a>(unit, flags, out_sysport, out_vlan, ing_intf_out,
<a name="l00444"></a>00444         next_hop_mac, &amp;l3egid);
<a name="l00445"></a>00445     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00446"></a>00446       printf(<span class="stringliteral">&quot;Error, create egress object, out_sysport=%d, in unit %d\n&quot;</span>,
<a name="l00447"></a>00447           out_sysport, unit);
<a name="l00448"></a>00448     }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     <span class="comment">/*** add host point ***/</span>
<a name="l00451"></a>00451     host = <a class="code" href="example__routing_8c.html#a2971da41865730e076908e0ae6757103">HOST1</a>;
<a name="l00452"></a>00452     rv = <a class="code" href="example__routing_8c.html#aac2edc87c4397b83513067ac545599ea" title="Add host address to the routing table.">example_add_host</a>(unit, host, l3egid);
<a name="l00453"></a>00453     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00454"></a>00454       printf(<span class="stringliteral">&quot;Error, create egress object, in_sysport=%d, in unit %d \n&quot;</span>,
<a name="l00455"></a>00455           in_sysport, unit);
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457 
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="comment">/*** add default route ***/</span>
<a name="l00460"></a>00460     subnet = <a class="code" href="example__routing_8c.html#a84f447ab6677e412dc77e89f08152369">DEFAULT_SUBNET_IP</a>;
<a name="l00461"></a>00461     mask   = <a class="code" href="example__routing_8c.html#a6bf0d6365e5891e41a12fe0a84452a46">DEFAULT_SUBNET_MASK</a>;
<a name="l00462"></a>00462     rv = <a class="code" href="example__routing_8c.html#abce61c2dc135d7be41729d8dc9f5cf31" title="Add default route to a subnet.">example_set_default_route</a>(unit, subnet, mask, l3egid, 0);
<a name="l00463"></a>00463     <span class="keywordflow">if</span> (rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00464"></a>00464       printf(<span class="stringliteral">&quot;Error, create egress object, in_sysport=%d, in unit %d \n&quot;</span>,
<a name="l00465"></a>00465           in_sysport, unit);
<a name="l00466"></a>00466     }
<a name="l00467"></a>00467   }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469   <span class="keywordflow">while</span>(1) {
<a name="l00470"></a>00470     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00471"></a>00471     printf(<span class="stringliteral">&quot;1. Save the configuration to scache\n&quot;</span>);
<a name="l00472"></a>00472 <span class="preprocessor">#ifndef CDP_EXCLUDE</span>
<a name="l00473"></a>00473 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00474"></a>00474 <span class="preprocessor">#endif</span>
<a name="l00475"></a>00475 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application.\r\n&quot;</span>);
<a name="l00476"></a>00476 
<a name="l00477"></a>00477     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00478"></a>00478     {
<a name="l00479"></a>00479         printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00480"></a>00480         <span class="keywordflow">continue</span>;
<a name="l00481"></a>00481     }
<a name="l00482"></a>00482     <span class="keywordflow">switch</span>(choice)
<a name="l00483"></a>00483     {
<a name="l00484"></a>00484       <span class="keywordflow">case</span> 1:
<a name="l00485"></a>00485       {
<a name="l00486"></a>00486         <span class="comment">/* Sync the current configuration */</span>
<a name="l00487"></a>00487         rv = <a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(unit, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca0aa383217d779424e826a470d4c924ae" title="Force a sync of the Level 2 warm boot state on demand.">opennslSwitchControlSync</a>, 1);
<a name="l00488"></a>00488         <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00489"></a>00489           printf(<span class="stringliteral">&quot;Failed to synchronize the configuration to scache. &quot;</span>
<a name="l00490"></a>00490               <span class="stringliteral">&quot;Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00491"></a>00491           <span class="keywordflow">return</span> rv;
<a name="l00492"></a>00492         }
<a name="l00493"></a>00493         printf(<span class="stringliteral">&quot;Warmboot configuration is saved successfully.\n&quot;</span>);
<a name="l00494"></a>00494         <span class="keywordflow">break</span>;
<a name="l00495"></a>00495       } <span class="comment">/* End of case 1 */</span>
<a name="l00496"></a>00496 
<a name="l00497"></a>00497 <span class="preprocessor">#ifndef CDP_EXCLUDE</span>
<a name="l00498"></a>00498 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00499"></a>00499       {
<a name="l00500"></a>00500         <a class="code" href="driver_8h.html#a471900b16ad87718cd84e257ef98ca57">opennsl_driver_shell</a>();
<a name="l00501"></a>00501         <span class="keywordflow">break</span>;
<a name="l00502"></a>00502       }
<a name="l00503"></a>00503 <span class="preprocessor">#endif</span>
<a name="l00504"></a>00504 <span class="preprocessor"></span>
<a name="l00505"></a>00505       <span class="keywordflow">case</span> 0:
<a name="l00506"></a>00506       {
<a name="l00507"></a>00507         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00508"></a>00508         <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00509"></a>00509       }
<a name="l00510"></a>00510       <span class="keywordflow">default</span>:
<a name="l00511"></a>00511       <span class="keywordflow">break</span>;
<a name="l00512"></a>00512     } <span class="comment">/* End of switch */</span>
<a name="l00513"></a>00513   } <span class="comment">/* End of while */</span>
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   <span class="keywordflow">return</span> rv;
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 <span class="comment">/* __doxy_func_body_end__ */</span>
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2015 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
