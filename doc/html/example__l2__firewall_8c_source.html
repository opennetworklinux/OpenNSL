<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OpenNSL API Guide and Reference Manual: examples/example_l2_firewall.c Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen/doxygen_brcm.css" rel="stylesheet" type="text/css" />



</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenNSL API Guide and Reference Manual
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Welcome</span></a></li>
      <li><a href="pages.html"><span>OpenNSL&#160;Documentation</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">examples/example_l2_firewall.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="example__l2__firewall_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*********************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *</span>
<a name="l00003"></a>00003 <span class="comment"> * (C) Copyright Broadcom Corporation 2013-2015</span>
<a name="l00004"></a>00004 <span class="comment"> *</span>
<a name="l00005"></a>00005 <span class="comment"> *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<a name="l00006"></a>00006 <span class="comment"> *  you may not use this file except in compliance with the License.</span>
<a name="l00007"></a>00007 <span class="comment"> *  You may obtain a copy of the License at</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span>
<a name="l00010"></a>00010 <span class="comment"> *</span>
<a name="l00011"></a>00011 <span class="comment"> *  Unless required by applicable law or agreed to in writing, software</span>
<a name="l00012"></a>00012 <span class="comment"> *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<a name="l00013"></a>00013 <span class="comment"> *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<a name="l00014"></a>00014 <span class="comment"> *  See the License for the specific language governing permissions and</span>
<a name="l00015"></a>00015 <span class="comment"> *  limitations under the License.</span>
<a name="l00016"></a>00016 <span class="comment"> *</span>
<a name="l00017"></a>00017 <span class="comment"> **********************************************************************</span>
<a name="l00018"></a>00018 <span class="comment"> * \file     example_l2_firewall.c</span>
<a name="l00019"></a>00019 <span class="comment"> *</span>
<a name="l00020"></a>00020 <span class="comment"> * \brief    Example code for Layer2 firewall</span>
<a name="l00021"></a>00021 <span class="comment"> *</span>
<a name="l00022"></a>00022 <span class="comment"> * \details  This example demonstrates a simple Layer 2 Firewall use case,</span>
<a name="l00023"></a>00023 <span class="comment"> * where a network administrator can block unauthorized stations from accessing</span>
<a name="l00024"></a>00024 <span class="comment"> * the network. The match criteria for the firewall rules can be either source</span>
<a name="l00025"></a>00025 <span class="comment"> * MAC address or destination MAC address. Frames matching the firewall rule</span>
<a name="l00026"></a>00026 <span class="comment"> * can either be dropped or forwarded. A centralized firewall server can</span>
<a name="l00027"></a>00027 <span class="comment"> * maintain the firewall rules for all the Layer2 switches in the network.</span>
<a name="l00028"></a>00028 <span class="comment"> * If the match criteria is source MAC address, packets originating with that</span>
<a name="l00029"></a>00029 <span class="comment"> * MAC address are matched. If the match criteria is destination MAC address,</span>
<a name="l00030"></a>00030 <span class="comment"> * packets destined to that MAC address are matched.</span>
<a name="l00031"></a>00031 <span class="comment"> *</span>
<a name="l00032"></a>00032 <span class="comment"> * This application also supports Warmboot feature. Warmboot is the</span>
<a name="l00033"></a>00033 <span class="comment"> * process of restarting the device driver software while the hardware is</span>
<a name="l00034"></a>00034 <span class="comment"> * running without interrupting the dataplane.</span>
<a name="l00035"></a>00035 <span class="comment"> *</span>
<a name="l00036"></a>00036 <span class="comment"> * Setup the following envinonment variable before running the application.</span>
<a name="l00037"></a>00037 <span class="comment"> * For Cold boot mode, use &quot;export SOC_BOOT_FLAGS = 0x000000&quot;.</span>
<a name="l00038"></a>00038 <span class="comment"> * For Warm boot mode, use &quot;export SOC_BOOT_FLAGS = 0x200000&quot;.</span>
<a name="l00039"></a>00039 <span class="comment"> *</span>
<a name="l00040"></a>00040 <span class="comment"> ************************************************************************/</span>
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="driver_8h.html">sal/driver.h</a>&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2error_8h.html">opennsl/error.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="l2_8h.html">opennsl/l2.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="opennsl_2switch_8h.html">opennsl/switch.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="vlan_8h.html">opennsl/vlan.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="examples_2util_8h.html">examples/util.h</a>&gt;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="example__l2__firewall_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">00052</a> <span class="preprocessor">#define DEFAULT_UNIT  0</span>
<a name="l00053"></a><a class="code" href="example__l2__firewall_8c.html#a91668ed1245d073a2ac84e6121205d28">00053</a> <span class="preprocessor"></span><span class="preprocessor">#define DEFAULT_VLAN  1</span>
<a name="l00054"></a><a class="code" href="example__l2__firewall_8c.html#a068278b0838b6670ab0ab0a93ed77484">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define MAX_DIGITS_IN_CHOICE 5</span>
<a name="l00055"></a>00055 <span class="preprocessor"></span>
<a name="l00056"></a><a class="code" href="example__l2__firewall_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">00056</a> <span class="keywordtype">char</span> <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>[] =
<a name="l00057"></a>00057 <span class="stringliteral">&quot;Syntax: example_l2_firewall                                           \n\r&quot;</span>
<a name="l00058"></a>00058 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00059"></a>00059 <span class="stringliteral">&quot;Paramaters: None.                                                     \n\r&quot;</span>
<a name="l00060"></a>00060 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00061"></a>00061 <span class="stringliteral">&quot;Example: The following command is used to allow or block station A    \n\r&quot;</span>
<a name="l00062"></a>00062 <span class="stringliteral">&quot;and station D that are part of VLAN 1 with MAC addresses              \n\r&quot;</span>
<a name="l00063"></a>00063 <span class="stringliteral">&quot;00:00:00:00:00:01 and 00:00:00:00:00:04 respectively.                 \n\r&quot;</span>
<a name="l00064"></a>00064 <span class="stringliteral">&quot;         example_l2_firewall                                          \n\r&quot;</span>
<a name="l00065"></a>00065 <span class="stringliteral">&quot;                                                                      \n\r&quot;</span>
<a name="l00066"></a>00066 <span class="stringliteral">&quot;Usage Guidelines: None.                                               \n\r&quot;</span>;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068 <span class="comment">/*****************************************************************/</span>
<a name="l00077"></a><a class="code" href="example__l2__firewall_8c.html#a62ade54d8285cc7ffaf88e130c52489f">00077</a> <span class="keywordtype">int</span> <a class="code" href="example__l2__firewall_8c.html#a62ade54d8285cc7ffaf88e130c52489f" title="Block the given station MAC address in the given VLAN.">example_l2_firewall_block_station</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac,
<a name="l00078"></a>00078     <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan)
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv;
<a name="l00081"></a>00081   <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> addr;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083   <a class="code" href="group__l2.html#ga47e819cf5939a8e643ad09505df52071" title="Initialize an L2 address structure to a specified MAC address and VLAN ID.">opennsl_l2_addr_t_init</a>(&amp;addr, mac, vlan);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085   <span class="comment">/* Set the static flag, discard flags */</span>
<a name="l00086"></a>00086   addr.<a class="code" href="structopennsl__l2__addr__s.html#a3c915015c746bbad9799b9a40a51b829" title="OPENNSL_L2_xxx flags.">flags</a> = (<a class="code" href="group__l2.html#ga838d2e1cee40e3ae41cd4a59599dd333">OPENNSL_L2_STATIC</a> | <a class="code" href="group__l2.html#gaa8fd8f76e972baba09166919ce64d69c">OPENNSL_L2_DISCARD_SRC</a> |
<a name="l00087"></a>00087       <a class="code" href="group__l2.html#gab7d426a93bd4d18707fec17663ec8588">OPENNSL_L2_DISCARD_DST</a>);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089   rv = <a class="code" href="group__l2.html#ga4b8920c1c3cf4c0c59bf8f0c5890f7c5" title="Add an L2 address entry to the specified device.">opennsl_l2_addr_add</a>(unit, &amp;addr);
<a name="l00090"></a>00090 
<a name="l00091"></a>00091   <span class="keywordflow">return</span> rv;
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">/*****************************************************************/</span>
<a name="l00104"></a><a class="code" href="example__l2__firewall_8c.html#ac751294a3c5688deaf848c1e3cb2e27d">00104</a> <span class="keywordtype">int</span> <a class="code" href="example__l2__firewall_8c.html#ac751294a3c5688deaf848c1e3cb2e27d" title="Unblock the given station MAC address in the given VLAN.">example_l2_firewall_allow_station</a>(<span class="keywordtype">int</span> unit, <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> mac,
<a name="l00105"></a>00105     <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan)
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a> rv;
<a name="l00108"></a>00108   <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> addr;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110   <span class="comment">/* Check whether the station exists in the firewall rules */</span>
<a name="l00111"></a>00111   rv = <a class="code" href="group__l2.html#ga1c92ed0757564763c9cb6c787a407e81" title="Check if an L2 entry is present in the L2 table.">opennsl_l2_addr_get</a>(unit, mac, vlan, &amp;addr);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <span class="keywordflow">if</span> (rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00114"></a>00114     rv = <a class="code" href="group__l2.html#gaa6330abc7fef65456cbf94282356fa1c" title="Delete an L2 address entry from the specified device.">opennsl_l2_addr_delete</a>(unit, mac, vlan);
<a name="l00115"></a>00115   }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117   <span class="keywordflow">return</span> rv;
<a name="l00118"></a>00118 }
<a name="l00119"></a>00119 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">/*****************************************************************/</span>
<a name="l00130"></a><a class="code" href="example__l2__firewall_8c.html#a69b1f853b2d7a1181f722fc78aeecef6">00130</a> <span class="keywordtype">int</span> <a class="code" href="example__l2__firewall_8c.html#a69b1f853b2d7a1181f722fc78aeecef6" title="Callback function to show L2 table information.">_opennsl_l2_traverse_cb</a>(
<a name="l00131"></a>00131     <span class="keywordtype">int</span> unit,
<a name="l00132"></a>00132     <a class="code" href="structopennsl__l2__addr__s.html" title="Device-independent L2 address structure.">opennsl_l2_addr_t</a> *info,
<a name="l00133"></a>00133     <span class="keywordtype">void</span> *user_data)
<a name="l00134"></a>00134 {
<a name="l00135"></a>00135   printf(<span class="stringliteral">&quot;MAC=%02x:%02x:%02x:%02x:%02x:%02x VLAN=%d PORT=%d\n&quot;</span>, info-&gt;<a class="code" href="structopennsl__l2__addr__s.html#a2a88662ae6f3e0f48704ba9c37c19c07" title="802.3 MAC address.">mac</a>[0],info-&gt;<a class="code" href="structopennsl__l2__addr__s.html#a2a88662ae6f3e0f48704ba9c37c19c07" title="802.3 MAC address.">mac</a>[1],info-&gt;<a class="code" href="structopennsl__l2__addr__s.html#a2a88662ae6f3e0f48704ba9c37c19c07" title="802.3 MAC address.">mac</a>[2],info-&gt;<a class="code" href="structopennsl__l2__addr__s.html#a2a88662ae6f3e0f48704ba9c37c19c07" title="802.3 MAC address.">mac</a>[3],info-&gt;<a class="code" href="structopennsl__l2__addr__s.html#a2a88662ae6f3e0f48704ba9c37c19c07" title="802.3 MAC address.">mac</a>[4],info-&gt;<a class="code" href="structopennsl__l2__addr__s.html#a2a88662ae6f3e0f48704ba9c37c19c07" title="802.3 MAC address.">mac</a>[5], info-&gt;<a class="code" href="structopennsl__l2__addr__s.html#a4a220dea5708ef83208923402a402cb1" title="VLAN identifier.">vid</a>, info-&gt;<a class="code" href="structopennsl__l2__addr__s.html#a7546884120ba8ab5dce9348fd9bd819f" title="Zero-based port number.">port</a>);
<a name="l00136"></a>00136   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 <span class="comment">/*****************************************************************/</span>
<a name="l00147"></a><a class="code" href="example__l2__firewall_8c.html#a0ddf1224851353fc92bfbff6f499fa97">00147</a> <span class="keywordtype">int</span> <a class="code" href="example__bst_8c.html#a0ddf1224851353fc92bfbff6f499fa97" title="Main function for bst sample application.">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
<a name="l00148"></a>00148 {
<a name="l00149"></a>00149   <a class="code" href="group__error.html#gac798c5c818a3213c27d2900d47add7f9" title="OPENNSL API error codes.">opennsl_error_t</a>   rv;
<a name="l00150"></a>00150   <a class="code" href="group__types.html#gaff94709d1708a51eb9aadb2e9fa03875" title="opennsl_vlan_t">opennsl_vlan_t</a> vlan = 1;
<a name="l00151"></a>00151   <span class="keywordtype">int</span> choice;
<a name="l00152"></a>00152   <span class="keywordtype">int</span> unit = <a class="code" href="example__l2__firewall_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>;
<a name="l00153"></a>00153   <span class="keywordtype">void</span> *user_data;
<a name="l00154"></a>00154   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> warm_boot;
<a name="l00155"></a>00155   <span class="keywordtype">int</span> index = 0;
<a name="l00156"></a>00156 
<a name="l00157"></a>00157   <span class="keywordflow">if</span>(strcmp(argv[0], <span class="stringliteral">&quot;gdb&quot;</span>) == 0)
<a name="l00158"></a>00158   {
<a name="l00159"></a>00159     index = 1;
<a name="l00160"></a>00160   }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162   warm_boot = <a class="code" href="examples_2util_8h.html#a40d56641f8e6b64b49c9813b7c27c75a" title="To get boot flags fetched from environment.">opennsl_boot_flags_get</a>() &amp; <a class="code" href="examples_2util_8h.html#aa6fc4fddb8d12deb70b0401eba5b8c54">OPENNSL_BOOT_F_WARM_BOOT</a>;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164   <span class="comment">/* Example MAC address of stations A, B, C and D */</span>
<a name="l00165"></a>00165   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> station_a = {0x00, 0x00, 0x00, 0x00, 0x00, 0x1};
<a name="l00166"></a>00166   <a class="code" href="group__types.html#ga016605921f5a8bd7ed96bb1b6195178a" title="opennsl_mac_t">opennsl_mac_t</a> station_d = {0x00, 0x00, 0x00, 0x00, 0x00, 0x4};
<a name="l00167"></a>00167 
<a name="l00168"></a>00168   <span class="keywordflow">if</span>((argc != (index + 1)) || ((argc &gt; (index + 1)) &amp;&amp; (strcmp(argv[index + 1], <span class="stringliteral">&quot;--help&quot;</span>) == 0))) {
<a name="l00169"></a>00169     printf(<span class="stringliteral">&quot;%s\n\r&quot;</span>, <a class="code" href="example__bst_8c.html#afc7d01e6dbea2c820a68fb8081c58a89">example_usage</a>);
<a name="l00170"></a>00170     <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a8b380efdb47b4a4b0ebafbb1c7823748">OPENNSL_E_PARAM</a>;
<a name="l00171"></a>00171   }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173   <span class="comment">/* Initialize the system. */</span>
<a name="l00174"></a>00174   printf(<span class="stringliteral">&quot;Initializing the system.\r\n&quot;</span>);
<a name="l00175"></a>00175   rv = <a class="code" href="driver_8h.html#a1c3e46e06d91a45608e9839952c60ff2">opennsl_driver_init</a>();
<a name="l00176"></a>00176 
<a name="l00177"></a>00177   <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00178"></a>00178     printf(<span class="stringliteral">&quot;\r\nFailed to initialize the system. Error %s\r\n&quot;</span>,
<a name="l00179"></a>00179         <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00180"></a>00180     <span class="keywordflow">return</span> rv;
<a name="l00181"></a>00181   }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183   <span class="keywordflow">if</span> (!warm_boot)
<a name="l00184"></a>00184   {
<a name="l00185"></a>00185 
<a name="l00186"></a>00186     <span class="comment">/* Add ports to default vlan. */</span>
<a name="l00187"></a>00187     printf(<span class="stringliteral">&quot;Adding ports to default vlan.\r\n&quot;</span>);
<a name="l00188"></a>00188     rv = <a class="code" href="examples_2util_8h.html#a2d14e4de1f4a7192ac7e378f8f7c63ff" title="Add all ports to default vlan.">example_switch_default_vlan_config</a>(unit);
<a name="l00189"></a>00189     <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00190"></a>00190       printf(<span class="stringliteral">&quot;\r\nFailed to add default ports. rv: %s\r\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00191"></a>00191       <span class="keywordflow">return</span> rv;
<a name="l00192"></a>00192     }
<a name="l00193"></a>00193   }
<a name="l00194"></a>00194 
<a name="l00195"></a>00195   <span class="keywordflow">while</span> (1) {
<a name="l00196"></a>00196     printf(<span class="stringliteral">&quot;\r\nUser menu: Select one of the following options\r\n&quot;</span>);
<a name="l00197"></a>00197     printf(<span class="stringliteral">&quot;1. Apply firewall\n&quot;</span>);
<a name="l00198"></a>00198     printf(<span class="stringliteral">&quot;2. Remove firewall\n&quot;</span>);
<a name="l00199"></a>00199     printf(<span class="stringliteral">&quot;3. Show L2 table\n&quot;</span>);
<a name="l00200"></a>00200     printf(<span class="stringliteral">&quot;4. Save the configuration to scache\n&quot;</span>);
<a name="l00201"></a>00201 <span class="preprocessor">#ifndef CDP_EXCLUDE</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;9. Launch diagnostic shell\n&quot;</span>);
<a name="l00203"></a>00203 <span class="preprocessor">#endif</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;0. Quit the application\n&quot;</span>);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="keywordflow">if</span>(<a class="code" href="examples_2util_8h.html#ad0173c952d5a8af01c14eebabc05b5df" title="Read numeric menu choice from user.">example_read_user_choice</a>(&amp;choice) != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>)
<a name="l00207"></a>00207     {
<a name="l00208"></a>00208         printf(<span class="stringliteral">&quot;Invalid option entered. Please re-enter.\n&quot;</span>);
<a name="l00209"></a>00209         <span class="keywordflow">continue</span>;
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211     <span class="keywordflow">switch</span>(choice){
<a name="l00212"></a>00212 
<a name="l00213"></a>00213       <span class="keywordflow">case</span> 1:
<a name="l00214"></a>00214       {
<a name="l00215"></a>00215         <span class="comment">/* Apply firewall rules to block station A and D */</span>
<a name="l00216"></a>00216         rv = <a class="code" href="example__l2__firewall_8c.html#a62ade54d8285cc7ffaf88e130c52489f" title="Block the given station MAC address in the given VLAN.">example_l2_firewall_block_station</a>(unit, station_a, vlan);
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00218"></a>00218           printf(<span class="stringliteral">&quot;L2 firewall: station A blocked successfully\n&quot;</span>);
<a name="l00219"></a>00219         } <span class="keywordflow">else</span> {
<a name="l00220"></a>00220           printf(<span class="stringliteral">&quot;L2 firewall: failed to apply rule. Error %s\n&quot;</span>,
<a name="l00221"></a>00221                  <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00222"></a>00222           <span class="keywordflow">return</span> rv;
<a name="l00223"></a>00223         }
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         rv = <a class="code" href="example__l2__firewall_8c.html#a62ade54d8285cc7ffaf88e130c52489f" title="Block the given station MAC address in the given VLAN.">example_l2_firewall_block_station</a>(unit, station_d, vlan);
<a name="l00226"></a>00226         <span class="keywordflow">if</span> (rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00227"></a>00227           printf(<span class="stringliteral">&quot;L2 firewall rule: station D blocked successfully\n&quot;</span>);
<a name="l00228"></a>00228         } <span class="keywordflow">else</span> {
<a name="l00229"></a>00229           printf(<span class="stringliteral">&quot;L2 firewall: failed to apply rule. Error %s\n&quot;</span>,
<a name="l00230"></a>00230                  <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00231"></a>00231           <span class="keywordflow">return</span> rv;
<a name="l00232"></a>00232         }
<a name="l00233"></a>00233         <span class="keywordflow">break</span>;
<a name="l00234"></a>00234       } <span class="comment">/* End of case 1 */</span>
<a name="l00235"></a>00235 
<a name="l00236"></a>00236       <span class="keywordflow">case</span> 2:
<a name="l00237"></a>00237       {
<a name="l00238"></a>00238         <span class="comment">/* Remove the firewall rules applied to station A and D */</span>
<a name="l00239"></a>00239         rv = <a class="code" href="example__l2__firewall_8c.html#ac751294a3c5688deaf848c1e3cb2e27d" title="Unblock the given station MAC address in the given VLAN.">example_l2_firewall_allow_station</a>(unit, station_a, vlan);
<a name="l00240"></a>00240         <span class="keywordflow">if</span> ((rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) || (rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a90445f03d34051de0c90acfd955ef178">OPENNSL_E_NOT_FOUND</a>)) {
<a name="l00241"></a>00241           printf(<span class="stringliteral">&quot;L2 firewall: station A un-blocked successfully\n&quot;</span>);
<a name="l00242"></a>00242         } <span class="keywordflow">else</span> {
<a name="l00243"></a>00243           printf(<span class="stringliteral">&quot;L2 firewall: failed to apply rule. Error %s\n&quot;</span>,
<a name="l00244"></a>00244                  <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00245"></a>00245           <span class="keywordflow">return</span> rv;
<a name="l00246"></a>00246         }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248         rv = <a class="code" href="example__l2__firewall_8c.html#ac751294a3c5688deaf848c1e3cb2e27d" title="Unblock the given station MAC address in the given VLAN.">example_l2_firewall_allow_station</a>(unit, station_d, vlan);
<a name="l00249"></a>00249         <span class="keywordflow">if</span> ((rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) || (rv == <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a90445f03d34051de0c90acfd955ef178">OPENNSL_E_NOT_FOUND</a>)) {
<a name="l00250"></a>00250           printf(<span class="stringliteral">&quot;L2 firewall rule: station D un-blocked successfully\n&quot;</span>);
<a name="l00251"></a>00251         }  <span class="keywordflow">else</span> {
<a name="l00252"></a>00252           printf(<span class="stringliteral">&quot;L2 firewall: failed to apply rule. Error %s\n&quot;</span>,
<a name="l00253"></a>00253                  <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00254"></a>00254           <span class="keywordflow">return</span> rv;
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256         <span class="keywordflow">break</span>;
<a name="l00257"></a>00257       } <span class="comment">/* End of case 2 */</span>
<a name="l00258"></a>00258 
<a name="l00259"></a>00259       <span class="keywordflow">case</span> 3:
<a name="l00260"></a>00260       {
<a name="l00261"></a>00261         <span class="comment">/* Iterate over all valid entries in the L2 table */</span>
<a name="l00262"></a>00262         rv = <a class="code" href="group__l2.html#gaabce2ef30471846f89381e168d8eff4e" title="Iterates over all entries in the L2 table and executes user callback function for each entry...">opennsl_l2_traverse</a>(unit, &amp;<a class="code" href="example__l2__firewall_8c.html#a69b1f853b2d7a1181f722fc78aeecef6" title="Callback function to show L2 table information.">_opennsl_l2_traverse_cb</a>, user_data);
<a name="l00263"></a>00263         <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00264"></a>00264           printf(<span class="stringliteral">&quot;\r\nFailed to iterate over L2 table. rv: %s\r\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00265"></a>00265         }
<a name="l00266"></a>00266         <span class="keywordflow">break</span>;
<a name="l00267"></a>00267       } <span class="comment">/* End of case 3 */</span>
<a name="l00268"></a>00268 
<a name="l00269"></a>00269       <span class="keywordflow">case</span> 4:
<a name="l00270"></a>00270       {
<a name="l00271"></a>00271         <span class="comment">/* Sync the current configuration */</span>
<a name="l00272"></a>00272         rv = <a class="code" href="group__switch.html#gaecf4eb5e6b57081dc8f06c72919e4e0b" title="Configure port-specific and device-wide operating modes.">opennsl_switch_control_set</a>(<a class="code" href="example__l2__firewall_8c.html#adbb76aecfc5eef000cb4cb55bc2fd404">DEFAULT_UNIT</a>, <a class="code" href="group__switch.html#gga8465f9bee535c4a0c8e4360bcc21e33ca0aa383217d779424e826a470d4c924ae" title="Force a sync of the Level 2 warm boot state on demand.">opennslSwitchControlSync</a>, 1);
<a name="l00273"></a>00273         <span class="keywordflow">if</span>(rv != <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>) {
<a name="l00274"></a>00274           printf(<span class="stringliteral">&quot;Failed to synchronize the configuration to scache. &quot;</span>
<a name="l00275"></a>00275               <span class="stringliteral">&quot;Error %s\n&quot;</span>, <a class="code" href="group__error.html#ga6d47e9cb22df965b977f3810bdc0ce3e">opennsl_errmsg</a>(rv));
<a name="l00276"></a>00276           <span class="keywordflow">return</span> rv;
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278         printf(<span class="stringliteral">&quot;Warmboot configuration is saved successfully.\n&quot;</span>);
<a name="l00279"></a>00279         <span class="keywordflow">break</span>;
<a name="l00280"></a>00280       } <span class="comment">/* End of case 4 */</span>
<a name="l00281"></a>00281 
<a name="l00282"></a>00282 <span class="preprocessor">#ifndef CDP_EXCLUDE</span>
<a name="l00283"></a>00283 <span class="preprocessor"></span>      <span class="keywordflow">case</span> 9:
<a name="l00284"></a>00284       {
<a name="l00285"></a>00285         <a class="code" href="driver_8h.html#a471900b16ad87718cd84e257ef98ca57">opennsl_driver_shell</a>();
<a name="l00286"></a>00286         <span class="keywordflow">break</span>;
<a name="l00287"></a>00287       }
<a name="l00288"></a>00288 <span class="preprocessor">#endif</span>
<a name="l00289"></a>00289 <span class="preprocessor"></span>
<a name="l00290"></a>00290       <span class="keywordflow">case</span> 0:
<a name="l00291"></a>00291       {
<a name="l00292"></a>00292         printf(<span class="stringliteral">&quot;Exiting the application.\n&quot;</span>);
<a name="l00293"></a>00293         <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00294"></a>00294       }
<a name="l00295"></a>00295       <span class="keywordflow">default</span>:
<a name="l00296"></a>00296         <span class="keywordflow">break</span>;
<a name="l00297"></a>00297     } <span class="comment">/* End of switch */</span>
<a name="l00298"></a>00298   } <span class="comment">/* End of while */</span>
<a name="l00299"></a>00299 
<a name="l00300"></a>00300   <span class="keywordflow">return</span> <a class="code" href="group__error.html#ggab4c007d9d8465756b8f672c33764e6d5a549cc71e16fe086c0311d03bc995a11b">OPENNSL_E_NONE</a>;
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 <span class="comment">/* __doxy_func_body_end__ */</span>
<a name="l00303"></a>00303 
</pre></div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->


<!--BEGIN GENERATE_TREEVIEW -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->

<hr>
<p>	
<table class="footer-brcm">
	<tr>
		<td class="footer-brcm"><img src="BRCM_Red+Black_noTag_RGB.png" align=left></td>
		<td class="footer-brcm"><small><b>&copy;  2015 by Broadcom Corporation. All rights reserved.</b></small>
			<div class="footer-brcm"><small>Broadcom Corporation reserves the right to make changes without further notice to any products or data herein to improve reliability, function, or design. 
Information furnished by Broadcom Corporation is believed to be accurate and reliable. However, Broadcom Corporation does not assume any liability arising 
out of the application or use of this information, nor the application or use of any product or circuit described herein, neither does it convey any license 
under its patent rights nor the rights of others. </small>
			</div>
		</td>
	</tr>
</table>	
</p>	
	

</div>

<!--END GENERATE_TREEVIEW-->





</body>
</html>
